<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>æ­†æ™¨æŠ€æœ¯ç¬”è®°</title><link>https://xinchentechnote.github.io/note/</link><description>Recent content on æ­†æ™¨æŠ€æœ¯ç¬”è®°</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>xinchen@af83f787e8911dea9b3bf677746ebac9</copyright><lastBuildDate>Mon, 26 May 2025 11:48:25 +0800</lastBuildDate><atom:link href="https://xinchentechnote.github.io/note/index.xml" rel="self" type="application/rss+xml"/><item><title>Wiresharkæ’ä»¶å¼€å‘å®æˆ˜-Luaè§£æè‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®</title><link>https://xinchentechnote.github.io/note/p/wireshark%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-lua%E8%A7%A3%E6%9E%90%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8D%8F%E8%AE%AE/</link><pubDate>Mon, 26 May 2025 11:48:25 +0800</pubDate><guid>https://xinchentechnote.github.io/note/p/wireshark%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91%E5%AE%9E%E6%88%98-lua%E8%A7%A3%E6%9E%90%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%8D%8F%E8%AE%AE/</guid><description>&lt;h1 id="wiresharkæ’ä»¶å¼€å‘å®æˆ˜-luaè§£æè‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®">Wiresharkæ’ä»¶å¼€å‘å®æˆ˜-Luaè§£æè‡ªå®šä¹‰äºŒè¿›åˆ¶åè®®
&lt;/h1>&lt;p>åœ¨è°ƒè¯•è‡ªå®šä¹‰ TCP åè®®æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦æ„é€ åŸå§‹çš„äºŒè¿›åˆ¶æ•°æ®åŒ…å¹¶é€šè¿‡ Wireshark è¿›è¡ŒæŠ“åŒ…åˆ†æã€‚è¿™ç¯‡æ–‡ç« è®°å½•ä½¿ç”¨luaå¼€å‘Wiresharkæ’ä»¶è§£æç§æœ‰äºŒè¿›åˆ¶åè®®ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ &lt;strong>Python æ„é€ äºŒè¿›åˆ¶åè®®æ•°æ®åŒ…&lt;/strong>&lt;/li>
&lt;li>ä½¿ç”¨ &lt;strong>&lt;code>nc&lt;/code>ï¼ˆnetcatï¼‰å‘é€æ•°æ®&lt;/strong>&lt;/li>
&lt;li>é€šè¿‡ &lt;strong>tcpdump&lt;/strong> æŠ“åŒ…&lt;/li>
&lt;li>é€šè¿‡ &lt;strong>Wireshark&lt;/strong> + luaæ’ä»¶è§£ææ•°æ®åŒ…&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-åè®®ç»“æ„">ğŸ§© åè®®ç»“æ„
&lt;/h2>&lt;p>åè®®æ ¼å¼å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">[ uint16: msgType ][ uint16: bodyLen ][ bytes[bodyLen]: JSONå­—ç¬¦ä¸² ]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¾‹å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>msgType = &lt;code>1&lt;/code>ï¼ˆ0x0001ï¼‰&lt;/li>
&lt;li>bodyLen = &lt;code>9&lt;/code>ï¼ˆ0x0009ï¼‰&lt;/li>
&lt;li>body = &lt;code>{&amp;quot;a&amp;quot;:123}&lt;/code>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-æ­¥éª¤-1ä½¿ç”¨-python-æ„é€ äºŒè¿›åˆ¶æ•°æ®">ğŸ› ï¸ æ­¥éª¤ 1ï¼šä½¿ç”¨ Python æ„é€ äºŒè¿›åˆ¶æ•°æ®
&lt;/h2>&lt;p>ä½¿ç”¨ Python å°†ç»“æ„åŒ–æ•°æ®å†™å…¥ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ &lt;code>msg.bin&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">python3 -c &lt;span class="s1">&amp;#39;with open(&amp;#34;msg.bin&amp;#34;, &amp;#34;wb&amp;#34;) as f: f.write((1).to_bytes(2, &amp;#34;big&amp;#34;) + len(b&amp;#34;{\&amp;#34;a\&amp;#34;:123}&amp;#34;).to_bytes(2, &amp;#34;big&amp;#34;) + b&amp;#34;{\&amp;#34;a\&amp;#34;:123}&amp;#34;)&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¹Ÿå¯ä»¥ä½¿ç”¨xxd&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;000100097b2261223a3132337d&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> xxd -r -p &amp;gt; msg.bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ–‡ä»¶å†…å®¹å³ä¸ºï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>00 01&lt;/code>: msgType = 1&lt;/li>
&lt;li>&lt;code>00 09&lt;/code>: bodyLen = 9&lt;/li>
&lt;li>&lt;code>7b 22 61 22 3a 31 32 33 7d&lt;/code>: JSON = &lt;code>{&amp;quot;a&amp;quot;:123}&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>å¯ä»¥ä½¿ç”¨ &lt;code>xxd&lt;/code> éªŒè¯å†…å®¹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">xxd msg.bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://xinchentechnote.github.io/note/note/images/mgs-bin.png"
loading="lazy"
alt="æ¶ˆæ¯åŒ…"
>&lt;/p>
&lt;hr>
&lt;h2 id="-æ­¥éª¤-2ä½¿ç”¨-nc-æ¨¡æ‹Ÿå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®">ğŸš€ æ­¥éª¤ 2ï¼šä½¿ç”¨ &lt;code>nc&lt;/code> æ¨¡æ‹Ÿå®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€æ•°æ®
&lt;/h2>&lt;p>é€šè¿‡ncæ¨¡æ‹ŸtcpæœåŠ¡å™¨ç›‘å¬ç«¯å£ï¼Œä¾‹å¦‚ &lt;code>12345&lt;/code>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">nc -l -p &lt;span class="m">12345&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é€šè¿‡ncæ¨¡æ‹Ÿtcpå®¢æˆ·ç«¯ï¼Œå¾€æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># å‘é€æ•°æ®åˆ°ç›‘å¬ç«¯å£ 12345&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">nc 127.0.0.1 &lt;span class="m">12345&lt;/span> &amp;lt; msg.bin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ä¹Ÿå¯ä»¥é€šè¿‡ xxdç”ŸæˆäºŒè¿›åˆ¶æ•°æ®ç›´æ¥å‘é€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s1">&amp;#39;0001 0009 7b2261223a3132337d&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> xxd -r -p &lt;span class="p">|&lt;/span> nc 127.0.0.1 &lt;span class="m">12345&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="-æ­¥éª¤-3ä½¿ç”¨-tcpdump-æŠ“åŒ…">ğŸ“± æ­¥éª¤ 3ï¼šä½¿ç”¨ tcpdump æŠ“åŒ…
&lt;/h2>&lt;p>sudo tcpdump -i lo port 12345 -w capture.pcap&lt;/p>
&lt;ol>
&lt;li>å¯åŠ¨ Wireshark æ‰“å¼€&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://xinchentechnote.github.io/note/note/images/without-lua-plugin.png"
loading="lazy"
alt="åŠ è½½æ’ä»¶å‰"
>&lt;/p>
&lt;ol start="2">
&lt;li>åŸºäºluaå¼€å‘wiresharkæ’ä»¶&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">--[[
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> sample.lua Â© 2025 xinchen@af83f787e8911dea9b3bf677746ebac9
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> A simple Wireshark Lua dissector for a custom protocol whose payload is:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> [ uint16 msgType ][ uint16 bodyLen ][ bytes[bodyLen] containing a JSON string ]
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> To use:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> 1. Save this file as â€œsample.luaâ€ (or any name ending in .lua).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> 2. Place it into your Wireshark plugins directory (e.g., on Windows:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> C:\Program Files\Wireshark\plugins\&amp;lt;version&amp;gt;\ or under ~/.config/wireshark/plugins/ for Linux/Mac).
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> 3. Restart Wireshark.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> 4. If your protocol runs over TCP on port 12345, it will now decode automatically.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> (Adjust the port number in the last lines below to match your actual port.)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm">--]]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 1. Define the protocol&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">sample&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">Proto&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;sample&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;My JSONâ€Overâ€Binary Protocol&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 2. Define the fields we want to extract:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- - msgType: uint16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- - bodyLen: uint16&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- - jsonStr: the JSON text (bytes interpreted as string)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">f_msgType&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ProtoField.uint16&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;sample.msgType&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Message Type&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">base.DEC&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">f_bodyLen&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ProtoField.uint16&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;sample.bodyLen&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Body Length&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">base.DEC&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">f_jsonStr&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ProtoField.string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;sample.json&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;JSON Payload&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">base.ASCII&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sample.fields&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">f_msgType&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">f_bodyLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">f_jsonStr&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 3. The dissector function&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">function&lt;/span> &lt;span class="nc">sample&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">dissector&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">buffer&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">pinfo&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">tree&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- buffer: the entire packetâ€™s raw bytes&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- pinfo: packet metadata (e.g. columns, protocol)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- tree: the protocol tree to which we add our parsed fields&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- First, ensure we have at least 4 bytes for msgType + bodyLen&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">if&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="mi">4&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- Tell Wireshark which protocol column to display&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">pinfo.cols&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">protocol&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sample.name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- Add a subtree â€œMy JSONâ€Overâ€Binary Protocolâ€&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">subtree&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">tree&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sample&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s2">&amp;#34;My JSONâ€Overâ€Binary Protocol Data&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- 3.1 Parse msgType (2 bytes)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">msgType_field&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">offset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">msgType_val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">msgType_field&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">uint&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subtree&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f_msgType&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">msgType_field&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">offset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- 3.2 Parse bodyLen (2 bytes)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">bodyLen_field&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">offset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">bodyLen_val&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">bodyLen_field&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">uint&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subtree&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f_bodyLen&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">bodyLen_field&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">offset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="mi">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- 3.3 Check if full JSON payload is available&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">if&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">len&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">bodyLen_val&lt;/span> &lt;span class="kr">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- If not enough bytes, mark it as malformed/truncated&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subtree&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">add_expert_info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">PI_MALFORMED&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">PI_ERROR&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Packet too short for advertised bodyLen&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">return&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- 3.4 Extract the JSON string bytes, interpret as ASCII/UTF-8&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">local&lt;/span> &lt;span class="n">json_field&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">buffer&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">offset&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">bodyLen_val&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- We use :string() so that Wireshark will display it as text&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subtree&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">f_jsonStr&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">json_field&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">offset&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">offset&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">bodyLen_val&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- (Optional) If you want to pretty-print or validate JSON,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- you could attempt to parse it here or use a heuristic.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">-- But for most purposes, displaying the raw string is enough.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kr">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- 4. Register the dissector on a specific TCP port (e.g. 12345).&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- Change â€œ12345â€ to whatever port your protocol actually uses, or&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- alternatively hook into a heuristic/UDP/etc. as desired.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kd">local&lt;/span> &lt;span class="n">tcp_port&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">DissectorTable.get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;tcp.port&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">tcp_port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="n">add&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">12345&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sample&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- If your protocol is over UDP, swap the last two lines with:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- local udp_port = DissectorTable.get(&amp;#34;udp.port&amp;#34;)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">-- udp_port:add(12345, sample)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¿å­˜ä¸º &lt;code>sample.lua&lt;/code> å¹¶æ”¾å…¥ Wireshark æ’ä»¶ç›®å½•ä¸­ï¼ˆå¦‚ &lt;code>~/.config/wireshark/plugins/&lt;/code>ï¼Œæˆ–windowä¸­&lt;code> C:\Program Files\Wireshark\plugins\&amp;lt;version&amp;gt;\&lt;/code>ï¼‰ï¼Œé‡æ–°æ‰“å¼€ Wireshark å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://xinchentechnote.github.io/note/note/images/with-lua-plugin.png"
loading="lazy"
alt="åŠ è½½æ’ä»¶å"
>&lt;/p>
&lt;h2 id="-æ­¥éª¤-4å¯é€‰ä½¿ç”¨-tcpdump-æŠ“åŒ…åˆ°-pcap-æ–‡ä»¶">ğŸ¥ª æ­¥éª¤ 4ï¼ˆå¯é€‰ï¼‰ï¼šä½¿ç”¨ &lt;code>tcpdump&lt;/code> æŠ“åŒ…åˆ° &lt;code>.pcap&lt;/code> æ–‡ä»¶
&lt;/h2>&lt;p>å¦‚æœä½ å¸Œæœ›åœ¨ç»ˆç«¯ä¸­è¿›è¡ŒæŠ“åŒ…æˆ–ç”Ÿæˆ &lt;code>.pcap&lt;/code> æ–‡ä»¶ç”¨äºåç»­åˆ†æï¼Œå¯ä»¥åœ¨ &lt;strong>Windows ä¸»æœºä¸Šå®‰è£… WinDumpï¼ˆtcpdump çš„ Windows ç‰ˆæœ¬ï¼‰&lt;/strong>ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>å®‰è£… &lt;a class="link" href="https://nmap.org/npcap/" target="_blank" rel="noopener"
>Npcap&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å®‰è£… &lt;a class="link" href="https://www.winpcap.org/windump/" target="_blank" rel="noopener"
>WinDump&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŸ¥çœ‹æ¥å£åˆ—è¡¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">windump -D
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>é€‰æ‹©æ­£ç¡®æ¥å£ç¼–å·ï¼Œå¼€å§‹æŠ“åŒ…ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">windump -i &lt;span class="m">3&lt;/span> tcp port &lt;span class="m">12345&lt;/span> -w test.pcap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨ Wireshark æ‰“å¼€ &lt;code>test.pcap&lt;/code> æ–‡ä»¶è¿›è¡Œåˆ†æã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="-æ€»ç»“">âœ… æ€»ç»“
&lt;/h2>&lt;p>é€šè¿‡ä»¥ä¸Šæ–¹å¼ï¼Œæˆ‘ä»¬å®Œæˆäº†ä»¥ä¸‹ç›®æ ‡ï¼š&lt;/p>
&lt;ul>
&lt;li>âœ… æ„é€ è‡ªå®šä¹‰åè®®çš„äºŒè¿›åˆ¶æ•°æ®&lt;/li>
&lt;li>âœ… ä½¿ç”¨ &lt;code>nc&lt;/code> æ¨¡æ‹Ÿå®¢æˆ·ç«¯åŠæœåŠ¡ç«¯å‘é€æ•°æ®&lt;/li>
&lt;li>âœ… ä½¿ç”¨ Wireshark å’Œ tcpdump æŠ“åŒ…&lt;/li>
&lt;li>âœ… ç¼–å†™ Lua è„šæœ¬è¿›è¡Œåè®®è§£æ&lt;/li>
&lt;/ul>
&lt;p>è¿™ç§æ–¹æ³•é€‚åˆè°ƒè¯•ä»»ä½•åŸºäº TCP/UDP çš„è‡ªå®šä¹‰åè®®ï¼Œéå¸¸é€‚åˆå¼€å‘å’Œæµ‹è¯•åœºæ™¯ã€‚&lt;/p>
&lt;hr>
&lt;p>å¦‚æœä½ ä¹Ÿåœ¨è°ƒè¯•è‡ªå·±çš„ç§æœ‰åè®®ï¼Œä¸å¦¨ç”¨è¿™ä¸ªæµç¨‹èµ°ä¸€éï¼å¸Œæœ›å¯¹ä½ æœ‰å¸®åŠ© ğŸ˜&lt;/p></description></item><item><title>C++è®¾è®¡æ¨¡å¼ä¸€</title><link>https://xinchentechnote.github.io/note/p/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/</link><pubDate>Sun, 25 May 2025 21:20:23 +0800</pubDate><guid>https://xinchentechnote.github.io/note/p/c-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B8%80/</guid><description>&lt;h1 id="c-äºŒè¿›åˆ¶é˜…è¯»å™¨è®¾è®¡æ¨¡å¼æ€»ç»“">C++ äºŒè¿›åˆ¶é˜…è¯»å™¨è®¾è®¡æ¨¡å¼æ€»ç»“
&lt;/h1>&lt;p>æœ¬æ–‡ä»è®¾è®¡æ¨¡å¼è§’åº¦å¯¹ä¸€ä¸ªåŸºäº C++ çš„äºŒè¿›åˆ¶æ•°æ®é˜…è¯»å™¨æ ¸å¿ƒæ¨¡å—è¿›è¡Œæ‹†è§£å’Œå½’çº³ï¼Œè¯¦ç»†ä»‹ç»äº†å¦‚ä½•é€šè¿‡å•ä¾‹ã€å·¥å‚ã€ç­–ç•¥ã€å¤‡å¿˜å½•ã€æ¨¡æ¿ä¸ç±»å‹ç‰¹å¾ç­‰æ¨¡å¼ï¼Œä½¿å¾—ä»£ç åœ¨æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§å’Œçµæ´»æ€§æ–¹é¢è¾¾åˆ°æœ€ä¼˜ã€‚æ–‡æœ«é™„æœ‰ä¸€å¼ å¯åœ¨ GitHub ä¸Šç›´æ¥æ¸²æŸ“çš„ Mermaid ç±»å›¾ï¼Œå¸®åŠ©ç›´è§‚ç†è§£å„æ¨¡å—ä¹‹é—´çš„å…³ç³»ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="ç›®å½•">ç›®å½•
&lt;/h2>&lt;ol>
&lt;li>&lt;a class="link" href="#%e8%ae%be%e8%ae%a1%e6%a8%a1%e5%bc%8f%e6%a6%82%e8%a7%88" >è®¾è®¡æ¨¡å¼æ¦‚è§ˆ&lt;/a>
1.1 &lt;a class="link" href="#%e5%8d%95%e4%be%8b%e6%a8%a1%e5%bc%8fsingleton" >å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰&lt;/a>
1.2 &lt;a class="link" href="#%e5%b7%a5%e5%8e%82%e6%a8%a1%e5%bc%8ffactory" >å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰&lt;/a>
1.3 &lt;a class="link" href="#%e7%ad%96%e7%95%a5%e6%a8%a1%e5%bc%8fstrategy" >ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰&lt;/a>
1.4 &lt;a class="link" href="#%e5%a4%87%e5%bf%98%e5%bd%95%e6%a8%a1%e5%bc%8fmemento" >å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰&lt;/a>
1.5 &lt;a class="link" href="#%e6%a8%a1%e6%9d%bf%e4%b8%8e%e7%b1%bb%e5%9e%8b%e7%89%b9%e5%be%81template--traits" >æ¨¡æ¿ä¸ç±»å‹ç‰¹å¾ï¼ˆTemplate &amp;amp; Traitsï¼‰&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="#%e5%90%84%e6%a8%a1%e5%9d%97%e4%b8%8e%e6%a8%a1%e5%bc%8f%e5%af%b9%e5%ba%94%e5%85%b3%e7%b3%bb" >å„æ¨¡å—ä¸æ¨¡å¼å¯¹åº”å…³ç³»&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="#mermaid-%e7%b1%bb%e5%9b%be" >Mermaid ç±»å›¾&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="#%e6%95%b4%e4%bd%93%e6%9e%b6%e6%9e%84%e4%b8%8e%e6%80%bb%e7%bb%93" >æ•´ä½“æ¶æ„ä¸æ€»ç»“&lt;/a>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="è®¾è®¡æ¨¡å¼æ¦‚è§ˆ">è®¾è®¡æ¨¡å¼æ¦‚è§ˆ
&lt;/h2>&lt;h3 id="å•ä¾‹æ¨¡å¼singleton">å•ä¾‹æ¨¡å¼ï¼ˆSingletonï¼‰
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ„å›¾&lt;/strong>ï¼šä¿è¯ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚&lt;/li>
&lt;li>&lt;strong>åº”ç”¨åœºæ™¯&lt;/strong>ï¼šå…¨å±€ç±»å‹æ³¨å†Œå™¨ã€å…¨å±€è¯»å–å™¨å·¥å‚ç­‰éœ€è¦å…±äº«çŠ¶æ€çš„åœºæ™¯ã€‚&lt;/li>
&lt;/ul>
&lt;p>åœ¨æœ¬é¡¹ç›®é‡Œï¼Œä»¥ä¸‹ä¸¤ä¸ªç±»è¢«è®¾è®¡ä¸ºå•ä¾‹ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>TypeFactory&lt;/code>ï¼šç»´æŠ¤â€œç±»å‹åç§°ï¼ˆå¦‚ &lt;code>&amp;quot;u8&amp;quot;&lt;/code>ã€&lt;code>&amp;quot;i16&amp;quot;&lt;/code>ï¼‰â†’ &lt;code>std::type_index&lt;/code>â€çš„æ˜ å°„ã€‚&lt;/li>
&lt;li>&lt;code>ReaderFactory&lt;/code>ï¼šç»´æŠ¤â€œè¯»å–ç±»å‹åç§°ï¼ˆå¦‚ &lt;code>&amp;quot;u8&amp;quot;&lt;/code>ã€&lt;code>&amp;quot;string@u8&amp;quot;&lt;/code>ï¼‰â†’ å¯¹åº”çš„ &lt;code>ReaderStrategy&lt;/code> å®ä¾‹â€ çš„æ˜ å°„ã€‚&lt;/li>
&lt;/ol>
&lt;p>å…¸å‹å®ç°ç¤ºä¾‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// TypeFactory.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">class&lt;/span> &lt;span class="nc">TypeFactory&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">TypeFactory&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// å±€éƒ¨é™æ€å˜é‡ï¼ŒC++11 åŠä»¥åä¿è¯çº¿ç¨‹å®‰å…¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ é™¤æ‹·è´/èµ‹å€¼æ“ä½œç¬¦ï¼Œé˜²æ­¢å¤åˆ¶
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">delete&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="k">operator&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">delete&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">type_index&lt;/span> &lt;span class="n">getTypeIndex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="err">â€¦&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">getTypeShortName&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;::&lt;/span>&lt;span class="n">short_name&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// â€¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// ç§æœ‰æ„é€ ï¼Œå†…éƒ¨å®Œæˆæ‰€æœ‰ç±»å‹æ³¨å†Œ
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="n">TypeFactory&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// ç§æœ‰ææ„
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unordered_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">type_index&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">type_map_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ReaderFactory.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">class&lt;/span> &lt;span class="nc">ReaderFactory&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">ReaderFactory&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// åŒæ ·åˆ©ç”¨å±€éƒ¨é™æ€å˜é‡ä¿è¯çº¿ç¨‹å®‰å…¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">inst&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åˆ é™¤æ‹·è´/èµ‹å€¼æ“ä½œç¬¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">delete&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="k">operator&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">delete&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">bool&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">typeName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">it&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">end&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">second&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="c1">// ç§æœ‰æ„é€ ï¼Œå†…éƒ¨æ³¨å†Œæ‰€æœ‰ ReaderStrategy
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="n">ReaderFactory&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unordered_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ReaderStrategy&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="n">emplaceReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">shortName&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">make_unique&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">TypedReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;strong>è¦ç‚¹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>ç§æœ‰æ„é€ /ææ„ã€åˆ é™¤æ‹·è´ä¸èµ‹å€¼ï¼Œç¡®ä¿åªèƒ½é€šè¿‡ &lt;code>instance()&lt;/code> è·å–å®ä¾‹ã€‚&lt;/li>
&lt;li>C++11 åï¼Œå±€éƒ¨é™æ€å˜é‡çš„åˆå§‹åŒ–çº¿ç¨‹å®‰å…¨ï¼Œæ— éœ€é¢å¤–åŠ é”ã€‚&lt;/li>
&lt;li>å•ä¾‹ä¸­æŒæœ‰å…¨å±€å…±äº«çš„æ•°æ®ï¼ˆå¦‚æ˜ å°„è¡¨ï¼‰ï¼Œåªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œé™ä½è¿è¡Œæ—¶å¼€é”€ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="å·¥å‚æ¨¡å¼factory">å·¥å‚æ¨¡å¼ï¼ˆFactoryï¼‰
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ„å›¾&lt;/strong>ï¼šå°†å¯¹è±¡çš„åˆ›å»ºä¸ä½¿ç”¨è§£è€¦ï¼Œè®©â€œè°æ¥åˆ›å»ºå¯¹è±¡â€å’Œâ€œå¦‚ä½•åˆ›å»ºå¯¹è±¡â€çš„é€»è¾‘å…¨éƒ¨é›†ä¸­åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªå·¥å‚ç±»é‡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>åº”ç”¨åœºæ™¯&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>æ–°å¢æˆ–ä¿®æ”¹æ”¯æŒçš„åŸºç¡€ç±»å‹æ—¶ï¼Œåªéœ€åœ¨å·¥å‚é‡Œæ³¨å†Œ/ä¿®æ”¹ç›¸å…³é€»è¾‘ï¼›&lt;/li>
&lt;li>å®¢æˆ·ç«¯æ— éœ€ç›´æ¥ &lt;code>new&lt;/code> æŸä¸ªç±»å‹ï¼Œè€Œæ˜¯ç»Ÿä¸€é€šè¿‡â€œç±»å‹åç§° â†’ å·¥å‚â€æ¥è·å–å®ä¾‹ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="121-typefactory">1.2.1 TypeFactory
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>ä½œç”¨ï¼šå®Œæˆâ€œç±»å‹åç§° â†’ &lt;code>std::type_index&lt;/code>â€çš„æ˜ å°„ä¸æŸ¥è¯¢ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†…éƒ¨ç»´æŠ¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unordered_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">type_index&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">type_map_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>æ„é€ å‡½æ•°ä¸­æ‰¹é‡æ³¨å†Œæ‰€æœ‰åŸºç¡€ç±»å‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">TypeFactory&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type_map_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;u8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">typeid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">uint8_t&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type_map_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;i16&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">typeid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int16_t&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">type_map_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;f32&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">typeid&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">float&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// â€¦æ›´å¤šç±»å‹æ³¨å†Œâ€¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>å¯¹å¤–æä¾›ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">type_index&lt;/span> &lt;span class="n">getTypeIndex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">getTypeShortName&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;::&lt;/span>&lt;span class="n">short_name&lt;/span>&lt;span class="p">();&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="122-readerfactory">1.2.2 ReaderFactory
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>ä½œç”¨ï¼šå®Œæˆâ€œç±»å‹åç§° â†’ &lt;code>ReaderStrategy&lt;/code> å®ä¾‹â€ çš„æ˜ å°„ä¸æŸ¥è¯¢ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å†…éƒ¨ç»´æŠ¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unordered_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">unique_ptr&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">ReaderStrategy&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>æ„é€ å‡½æ•°ä¸­æ³¨å†Œå„ç§è¯»å–ç­–ç•¥ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">ReaderFactory&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³¨å†ŒåŸºç¡€æ•´æ•°/æµ®ç‚¹ç±»å‹è¯»å–å™¨
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">emplaceReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint8_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;u8&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emplaceReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">int16_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;i16&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emplaceReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">float&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;f32&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³¨å†Œå›ºå®šé•¿åº¦å­—ç¬¦ä¸²è¯»å–å™¨ï¼Œä¾‹å¦‚ &amp;#34;string@8&amp;#34;ï¼šè¯»å– 8 å­—èŠ‚ C é£æ ¼å­—ç¬¦ä¸²
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;string@8&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">make_unique&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">FixStringReader&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// æ³¨å†Œé•¿åº¦å‰ç¼€å­—ç¬¦ä¸²è¯»å–å™¨ï¼Œä¾‹å¦‚ &amp;#34;string@u16&amp;#34;ï¼šå…ˆè¯»ä¸€ä¸ª uint16_t ä½œä¸ºé•¿åº¦ï¼Œå†è¯»åç»­å­—èŠ‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">emplace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;string@u16&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">make_unique&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">LengthPrefixedStringReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint16_t&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// â€¦æ›´å¤šæ³¨å†Œâ€¦
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>å¯¹å¤–æä¾›ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">bool&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">auto&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">find&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">typeName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">it&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="n">readers_&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">end&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">it&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">second&lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>è¦ç‚¹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>å°†ä¸åŒç±»å‹çš„â€œè¯»å–é€»è¾‘â€æ³¨å†Œåˆ°åŒä¸€ä¸ªæ˜ å°„è¡¨ &lt;code>readers_&lt;/code> ä¸­ï¼›&lt;/li>
&lt;li>å®¢æˆ·ç«¯åªéœ€è°ƒç”¨ &lt;code>ReaderFactory::instance().read(state, typeName)&lt;/code> å³å¯ï¼Œæ— éœ€å…³å¿ƒå†…éƒ¨å…·ä½“å®ç°ï¼›&lt;/li>
&lt;li>æ–°å¢è¯»å–ç±»å‹æ—¶ï¼Œåªè¦å®ç°æ–°çš„ &lt;code>ReaderStrategy&lt;/code> å¹¶åœ¨æ„é€ ä¸­æ³¨å†Œå³å¯ï¼Œç¬¦åˆå¼€é—­åŸåˆ™ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="ç­–ç•¥æ¨¡å¼strategy">ç­–ç•¥æ¨¡å¼ï¼ˆStrategyï¼‰
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ„å›¾&lt;/strong>ï¼šå®šä¹‰ä¸€ç³»åˆ—å¯äº’æ¢çš„ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ï¼Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒä»¬çš„å®¢æˆ·ç«¯è€Œå˜åŒ–ã€‚&lt;/li>
&lt;li>&lt;strong>åº”ç”¨åœºæ™¯&lt;/strong>ï¼šè¯»å–ä¸åŒç±»å‹çš„æ•°æ®ï¼ˆåŸºç¡€æ•´æ•°/æµ®ç‚¹ã€å›ºå®šé•¿åº¦å­—ç¬¦ä¸²ã€é•¿åº¦å‰ç¼€å­—ç¬¦ä¸²ï¼‰æœ¬è´¨ä¸Šå°±æ˜¯ä¸åŒçš„â€œè¯»å–ç®—æ³•â€ï¼Œç»Ÿä¸€ä½¿ç”¨ç›¸åŒæ¥å£å³å¯å®ç°åŠ¨æ€åˆ‡æ¢ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="131-æŠ½è±¡ç­–ç•¥æ¥å£readerstrategy">1.3.1 æŠ½è±¡ç­–ç•¥æ¥å£ï¼š&lt;code>ReaderStrategy&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ReaderStrategy.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">class&lt;/span> &lt;span class="nc">ReaderStrategy&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="o">~&lt;/span>&lt;span class="n">ReaderStrategy&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="k">default&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">virtual&lt;/span> &lt;span class="kt">bool&lt;/span> &lt;span class="nf">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;strong>æ ¸å¿ƒæ–¹æ³•&lt;/strong>ï¼š&lt;code>bool read(AppState&amp;amp; state, std::string typeName) const&lt;/code>ï¼Œæ¥æ”¶å½“å‰åº”ç”¨çŠ¶æ€ &lt;code>AppState&lt;/code> å’Œå¾…è¯»å–æ•°æ®çš„â€œç±»å‹åç§°â€ï¼Œè¿”å›æ˜¯å¦è¯»å–æˆåŠŸï¼ŒåŒæ—¶åœ¨å†…éƒ¨æ›´æ–° &lt;code>AppState&lt;/code>ï¼ˆæ¸¸æ ‡ä½ç½®ã€çŠ¶æ€æ¶ˆæ¯ã€å†å²è®°å½•ç­‰ï¼‰ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="132-å…·ä½“ç­–ç•¥">1.3.2 å…·ä½“ç­–ç•¥
&lt;/h4>&lt;ol>
&lt;li>
&lt;p>&lt;strong>TypedReader&lt;T>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç”¨äºè¯»å–å®šé•¿çš„åŸºç¡€ç±»å‹ï¼ˆå¦‚ &lt;code>uint8_t&lt;/code>ã€&lt;code>int16_t&lt;/code>ã€&lt;code>float&lt;/code> ç­‰ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€šè¿‡æ¨¡æ¿å‚æ•° &lt;code>T&lt;/code>ï¼Œåœ¨ &lt;code>read()&lt;/code> ä¸­è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getCursorPos&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setStatusMsg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Read {}: {} @ 0x{:X}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Utils&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getCursorPos&lt;/span>&lt;span class="p">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>åœ¨ &lt;code>ReaderFactory&lt;/code> ä¸­ä½¿ç”¨ &lt;code>emplaceReader&amp;lt;uint8_t&amp;gt;(&amp;quot;u8&amp;quot;)&lt;/code>ã€&lt;code>emplaceReader&amp;lt;int16_t&amp;gt;(&amp;quot;i16&amp;quot;)&lt;/code> ç­‰æ¥æ³¨å†Œã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>FixStringReader&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç”¨äºè¯»å–â€œå›ºå®šé•¿åº¦çš„ C é£æ ¼å­—ç¬¦ä¸²â€ï¼Œæ„é€ æ—¶ä¼ å…¥ä¸€ä¸ª &lt;code>size_t length&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>read()&lt;/code> çš„å®ç°ç±»ä¼¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">read_fixed_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getCursorPos&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">length_&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">setStatusMsg&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Read {}: {} @ 0x{:X}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Utils&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getCursorPos&lt;/span>&lt;span class="p">()));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">return&lt;/span> &lt;span class="nb">true&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>LengthPrefixedStringReader&lt;LengthType>&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ç”¨äºè¯»å–â€œé•¿åº¦å‰ç¼€å­—ç¬¦ä¸²â€ï¼Œæ¨¡æ¿å‚æ•° &lt;code>LengthType&lt;/code>ï¼ˆå¦‚ &lt;code>uint8_t&lt;/code>ã€&lt;code>uint16_t&lt;/code>ã€&lt;code>uint32_t&lt;/code> ç­‰ï¼‰ä»£è¡¨å‰ç¼€æ‰€å å­—èŠ‚æ•°ã€‚&lt;/li>
&lt;li>&lt;code>read()&lt;/code> å…ˆè°ƒç”¨ &lt;code>state.read&amp;lt;LengthType&amp;gt;(pos)&lt;/code> å¾—åˆ°å­—ç¬¦ä¸²é•¿åº¦ Nï¼Œå†ç»§ç»­è¯»å– N å­—èŠ‚ä½œä¸ºå®é™…å­—ç¬¦ä¸²ï¼Œæ›´æ–°çŠ¶æ€å¹¶è®°å½•å†å²ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>è¦ç‚¹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>å„ä¸ªè¯»å–é€»è¾‘ç»§æ‰¿è‡ªåŒä¸€ä¸ª &lt;code>ReaderStrategy&lt;/code> æ¥å£ï¼›&lt;/li>
&lt;li>åœ¨å·¥å‚ä¸­ç»Ÿä¸€æ³¨å†Œï¼ˆ&lt;code>readers_[&amp;quot;u8&amp;quot;] â†’ TypedReader&amp;lt;uint8_t&amp;gt;&lt;/code>ã€&lt;code>readers_[&amp;quot;string@u8&amp;quot;] â†’ LengthPrefixedStringReader&amp;lt;uint8_t&amp;gt;&lt;/code> ç­‰ï¼‰ï¼Œå®¢æˆ·ç«¯åªéœ€ä¼ å…¥ä¸åŒçš„ &lt;code>typeName&lt;/code>ï¼Œå·¥å‚ä¾¿ä¼šé€‰æ‹©å¯¹åº”ç­–ç•¥æ‰§è¡Œï¼›&lt;/li>
&lt;li>æ–°å¢ä¸€ç§è¯»å–é€»è¾‘ï¼ˆä¾‹å¦‚â€œå˜é•¿å‹ç¼©æ•´æ•°â€ï¼‰ï¼Œåªè¦å®ç°æ–°çš„ &lt;code>ReaderStrategy&lt;/code> å­ç±»å¹¶åœ¨ &lt;code>ReaderFactory&lt;/code> æ„é€ ä¸­æ³¨å†Œå³å¯ï¼Œæ— éœ€æ”¹åŠ¨å…¶å®ƒä¸šåŠ¡ä»£ç ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="å¤‡å¿˜å½•æ¨¡å¼memento">å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMementoï¼‰
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>æ„å›¾&lt;/strong>ï¼šåœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·å¹¶ä¿å­˜ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œä»¥ä¾¿åœ¨ä»¥åæ¢å¤ã€‚&lt;/li>
&lt;li>&lt;strong>åº”ç”¨åœºæ™¯&lt;/strong>ï¼šç”¨æˆ·åœ¨ä»»æ„æ—¶åˆ»å¯ä»¥â€œæ’¤é”€â€æœ€è¿‘ä¸€æ¬¡è¯»å–ï¼Œéœ€è¦è®°å½•æ¯æ¬¡è¯»å–å‰çš„æ¸¸æ ‡ä½ç½®ä¸è¯»å–åˆ°çš„æ•°æ®å€¼ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="141-å¤‡å¿˜å½•ç±»record">1.4.1 å¤‡å¿˜å½•ç±»ï¼š&lt;code>Record&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// Record.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">struct&lt;/span> &lt;span class="nc">Record&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// è¯»å–å‰çš„å…‰æ ‡ä½ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">any&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// è¯»å–åˆ°çš„å€¼ï¼ˆä»»æ„ç±»å‹ï¼‰
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">type_name&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// è®°å½•ç±»å‹çš„åç§°ï¼Œä¾¿äºå±•ç¤ºæˆ–æ—¥å¿—
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Record&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">idx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">any&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">:&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">idx&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">move&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">d&lt;/span>&lt;span class="p">)),&lt;/span> &lt;span class="n">type_name&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">t&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">description&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;{} @ 0x{:X}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">type_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">index&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;strong>èŒè´£&lt;/strong>ï¼šåœ¨â€œè¯»æ“ä½œâ€å‘ç”Ÿæ—¶ï¼Œå…ˆå°†å½“å‰å…‰æ ‡ &lt;code>index&lt;/code>ã€è¯»å–åˆ°çš„æ•°æ®ï¼ˆå°è£…ä¸º &lt;code>std::any&lt;/code>ï¼‰ä»¥åŠå¯¹åº”çš„ç±»å‹åç§°ä¸€èµ·æ‰“åŒ…æˆä¸€ä¸ª &lt;code>Record&lt;/code>ï¼Œå‹å…¥ &lt;code>AppState::read_history&lt;/code> æ ˆä¸­ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="142-åŸå‘å™¨appstate">1.4.2 åŸå‘å™¨ï¼š&lt;code>AppState&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// AppState.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">class&lt;/span> &lt;span class="nc">AppState&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AppState&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint8_t&lt;/span>&lt;span class="o">&amp;gt;&amp;amp;&lt;/span> &lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">:&lt;/span> &lt;span class="n">data_&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">peek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// ä» data_ ä¸­è¯»å– sizeof(T) å­—èŠ‚å¹¶æ ¹æ®å°ç«¯æˆ–å¤§ç«¯è½¬æ¢ä¸º T
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="o">++&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">value&lt;/span> &lt;span class="o">|=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">data_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">pos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">8&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">i&lt;/span>&lt;span class="p">));&lt;/span> &lt;span class="c1">// å‡è®¾å°ç«¯å­—èŠ‚åº
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">T&lt;/span> &lt;span class="n">value&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">peek&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// åœ¨è¯»å–å‰å…ˆä¿å­˜ä¸€ä»½â€œå¤‡å¿˜å½•â€åˆ° read_history
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">Record&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">getTypeShortName&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">()};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">read_history&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">move&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// å°†æ¸¸æ ‡å¾€å‰ç§»åŠ¨ sizeof(T) ä¸ªå­—èŠ‚
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">cursor_pos_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status_msg_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Read {}: {} @ 0x{:X}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Utils&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">value&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">value&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">read_fixed_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">reinterpret_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">data_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">]),&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Record&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;string@{}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">)};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">read_history&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">move&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cursor_pos_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status_msg_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Read {}: {} @ 0x{:X}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Utils&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">LengthType&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">read_length_prefixed_string&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LengthType&lt;/span> &lt;span class="n">len&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">LengthType&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// é€’å½’è°ƒç”¨ read&amp;lt;T&amp;gt;ï¼Œä¹Ÿä¼šè®°å½•å¤‡å¿˜å½•
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">strPos&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="k">sizeof&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">LengthType&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">reinterpret_cast&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="kt">char&lt;/span>&lt;span class="o">*&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="n">data_&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">strPos&lt;/span>&lt;span class="p">]),&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Record&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="n">pos&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;string@{}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">getTypeShortName&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">LengthType&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>&lt;span class="p">())};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">read_history&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">push&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">move&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">record&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cursor_pos_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">strPos&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">status_msg_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Read {}: {} @ 0x{:X}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Utils&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format_value&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">s&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">undo&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="n">read_history&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">empty&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Record&lt;/span> &lt;span class="n">record&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">read_history&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">top&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">read_history&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">pop&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">cursor_pos_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">index&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æ¢å¤åˆ°è¯»å–å‰çš„å…‰æ ‡ä½ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">status_msg_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">fmt&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">format&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Undo to {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">record&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">description&lt;/span>&lt;span class="p">());&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">size_t&lt;/span> &lt;span class="nf">getCursorPos&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">cursor_pos_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kt">void&lt;/span> &lt;span class="nf">setCursorPos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">cursor_pos_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">getStatusMsg&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">status_msg_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Record&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">getReadHistory&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">read_history&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">private&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">vector&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint8_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">data_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// å¾…è§£æçš„äºŒè¿›åˆ¶æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">cursor_pos_&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// å½“å‰å…‰æ ‡ä½ç½®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">status_msg_&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// æœ€è¿‘ä¸€æ¬¡æ“ä½œçš„çŠ¶æ€æ¶ˆæ¯
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">Record&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">read_history&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;strong>è¦ç‚¹&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;code>AppState&lt;/code> åŒæ—¶æ‰®æ¼”äº†â€œåŸå‘å™¨ï¼ˆOriginatorï¼‰â€å’Œâ€œç®¡ç†è€…ï¼ˆCaretakerï¼‰â€çš„è§’è‰²ï¼›&lt;/li>
&lt;li>æ¯æ¬¡ &lt;code>read&amp;lt;T&amp;gt;&lt;/code>ã€&lt;code>read_fixed_string()&lt;/code>ã€&lt;code>read_length_prefixed_string()&lt;/code> éƒ½ä¼šå…ˆå°†å½“å‰çŠ¶æ€å°è£…åˆ° &lt;code>Record&lt;/code>ï¼Œå†æ‰§è¡ŒçœŸæ­£çš„è¯»å–æ“ä½œï¼›&lt;/li>
&lt;li>&lt;code>undo()&lt;/code> ä»å †æ ˆé¡¶å¼¹å‡ºæœ€è¿‘çš„ &lt;code>Record&lt;/code>ï¼Œå¹¶æ¢å¤ &lt;code>cursor_pos_&lt;/code>ï¼Œè¾¾åˆ°â€œæ’¤é”€æœ€è¿‘ä¸€æ¬¡è¯»å–â€çš„æ•ˆæœï¼›&lt;/li>
&lt;li>é€šè¿‡è°ƒç”¨ &lt;code>getReadHistory()&lt;/code> å¯ä»¥è·å–æ•´ä¸ªè¯»å–å†å²æ ˆï¼Œä¾¿äºæ—¥å¿—è¾“å‡ºæˆ–è°ƒè¯•ã€‚&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="æ¨¡æ¿ä¸ç±»å‹ç‰¹å¾template--traits">æ¨¡æ¿ä¸ç±»å‹ç‰¹å¾ï¼ˆTemplate &amp;amp; Traitsï¼‰
&lt;/h3>&lt;ul>
&lt;li>
&lt;p>&lt;strong>æ„å›¾&lt;/strong>ï¼š&lt;/p>
&lt;ul>
&lt;li>åˆ©ç”¨ C++ æ¨¡æ¿ç”Ÿæˆå¯¹ä¸åŒåŸºç¡€ç±»å‹ï¼ˆå¦‚ &lt;code>uint8_t&lt;/code>ã€&lt;code>int16_t&lt;/code>ã€&lt;code>float&lt;/code> ç­‰ï¼‰çš„é€šç”¨è¯»å–é€»è¾‘ï¼Œå‡å°‘é‡å¤ä»£ç ï¼›&lt;/li>
&lt;li>é€šè¿‡â€œç±»å‹ç‰¹å¾ï¼ˆTraitsï¼‰â€åœ¨ç¼–è¯‘æœŸå°†ç±»å‹ä¸å®ƒä»¬å¯¹åº”çš„åç§°ç»‘å®šï¼Œæ–¹ä¾¿åœ¨ç¨‹åºè¿è¡Œæ—¶å–å¾—ç›¸åº”å­—ç¬¦ä¸²ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h4 id="151-ç±»å‹ç‰¹å¾typetraitst">1.5.1 ç±»å‹ç‰¹å¾ï¼š&lt;code>TypeTraits&amp;lt;T&amp;gt;&lt;/code>
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// TypeTraits.hpp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">template&lt;/span> &lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">TypeTraits&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åç‰¹åŒ–ï¼šuint8_t
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">template&lt;/span> &lt;span class="o">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">uint8_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;unsigned 8-bit integer&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">short_name&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;u8&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åç‰¹åŒ–ï¼šint16_t
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">template&lt;/span> &lt;span class="o">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">int16_t&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;signed 16-bit integer&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">short_name&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;i16&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// åç‰¹åŒ–ï¼šfloat
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">template&lt;/span> &lt;span class="o">&amp;lt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">struct&lt;/span> &lt;span class="nc">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="kt">float&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;32-bit floating point&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">short_name&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;f32&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// â€¦å…¶ä»–åŸºç¡€ç±»å‹çš„ç‰¹åŒ–â€¦
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>
&lt;p>&lt;strong>å¯¹å¤–æ¥å£&lt;/strong>ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="k">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="k">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">getTypeShortName&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;::&lt;/span>&lt;span class="n">short_name&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h4 id="152-appstatepeekt-ä¸-readt">1.5.2 &lt;code>AppState::peek&amp;lt;T&amp;gt;()&lt;/code> ä¸ &lt;code>read&amp;lt;T&amp;gt;()&lt;/code>
&lt;/h4>&lt;ul>
&lt;li>
&lt;p>&lt;code>peek&amp;lt;T&amp;gt;(pos)&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>ä» &lt;code>data_&lt;/code> ä¸­è¯»å– &lt;code>sizeof(T)&lt;/code> å­—èŠ‚å¹¶æ ¹æ®å°ç«¯æˆ–å¤§ç«¯è½¬æ¢ä¸ºç±»å‹ &lt;code>T&lt;/code>ã€‚&lt;/li>
&lt;li>åªåšâ€œæŸ¥çœ‹â€ä¸ä¿®æ”¹å…‰æ ‡ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>read&amp;lt;T&amp;gt;(pos)&lt;/code>ï¼š&lt;/p>
&lt;ul>
&lt;li>è°ƒç”¨ &lt;code>peek&amp;lt;T&amp;gt;(pos)&lt;/code> è·å–å€¼ï¼›&lt;/li>
&lt;li>å°† &lt;code>(pos, value, ç±»å‹åç§°)&lt;/code> å°è£…æˆ &lt;code>Record&lt;/code> å¹¶å‹å…¥ &lt;code>read_history&lt;/code>ï¼›&lt;/li>
&lt;li>å°† &lt;code>cursor_pos_&lt;/code> å¾€å‰ç§»åŠ¨ &lt;code>sizeof(T)&lt;/code> å­—èŠ‚ï¼›&lt;/li>
&lt;li>æ›´æ–° &lt;code>status_msg_&lt;/code> å¹¶è¿”å› &lt;code>value&lt;/code>ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;p>åˆ©ç”¨æ¨¡æ¿ï¼Œ&lt;code>AppState::peek&amp;lt;T&amp;gt;&lt;/code> / &lt;code>AppState::read&amp;lt;T&amp;gt;&lt;/code> å¯¹ä¸åŒåŸºç¡€ç±»å‹æ— éœ€å†™åˆ†æ”¯ï¼Œç»Ÿä¸€ç”±ç¼–è¯‘å™¨æ ¹æ® &lt;code>T&lt;/code> è‡ªåŠ¨ç”Ÿæˆå¯¹åº”ä»£ç ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="å„æ¨¡å—ä¸æ¨¡å¼å¯¹åº”å…³ç³»">å„æ¨¡å—ä¸æ¨¡å¼å¯¹åº”å…³ç³»
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ¨¡å— / ç±»&lt;/th>
&lt;th>è®¾è®¡æ¨¡å¼&lt;/th>
&lt;th>è¯´æ˜&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>TypeFactory&lt;/code>&lt;/td>
&lt;td>Singleton + Factory&lt;/td>
&lt;td>å•ä¾‹ï¼šå…¨å±€åªç»´æŠ¤ä¸€ä»½â€œç±»å‹æ˜ å°„â€ã€‚&lt;br>å·¥å‚ï¼šå®Œæˆâ€œç±»å‹å â†’ std::type_indexâ€ çš„æ³¨å†Œä¸æŸ¥è¯¢ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ReaderFactory&lt;/code>&lt;/td>
&lt;td>Singleton + Factory&lt;/td>
&lt;td>å•ä¾‹ï¼šå…¨å±€åªç»´æŠ¤ä¸€ä»½â€œè¯»å–å™¨æ˜ å°„â€ã€‚&lt;br>å·¥å‚ï¼šå®Œæˆâ€œç±»å‹å â†’ ReaderStrategyâ€ çš„æ³¨å†Œä¸æŸ¥è¯¢ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>ReaderStrategy&lt;/code>&lt;/td>
&lt;td>Strategy&lt;/td>
&lt;td>ç®—æ³•æ¥å£ï¼šå®šä¹‰ &lt;code>bool read(AppState&amp;amp;, std::string)&lt;/code>ï¼›&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>TypedReader&amp;lt;T&amp;gt;&lt;/code>&lt;/td>
&lt;td>Strategy + Template&lt;/td>
&lt;td>å…·ä½“ç­–ç•¥ï¼šè¯»å–åŸºç¡€ç±»å‹ &lt;code>T&lt;/code>ã€‚æ¨¡æ¿åŒ–ï¼šæ ¹æ® &lt;code>T&lt;/code> ä¸åŒè‡ªåŠ¨ç”Ÿæˆä¸åŒçš„è¯»å–é€»è¾‘ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>FixStringReader&lt;/code>&lt;/td>
&lt;td>Strategy&lt;/td>
&lt;td>å…·ä½“ç­–ç•¥ï¼šè¯»å–å›ºå®šé•¿åº¦çš„ C å­—ç¬¦ä¸²ã€‚æ„é€ æ—¶ä¼ å…¥å›ºå®šé•¿åº¦ &lt;code>length&lt;/code>ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>LengthPrefixedStringReader&amp;lt;LengthType&amp;gt;&lt;/code>&lt;/td>
&lt;td>Strategy + Template&lt;/td>
&lt;td>å…·ä½“ç­–ç•¥ï¼šè¯»å–â€œé•¿åº¦å‰ç¼€å­—ç¬¦ä¸²ï¼ˆLengthType è¡¨ç¤ºå‰ç¼€å®½åº¦ï¼‰â€ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>AppState&lt;/code>&lt;/td>
&lt;td>Memento + Template&lt;/td>
&lt;td>åŸå‘å™¨ &amp;amp; ç®¡ç†è€…ï¼šæ¯æ¬¡è¯»å–å‰å°†çŠ¶æ€å°è£…æˆ &lt;code>Record&lt;/code> å­˜å…¥æ ˆï¼›æ”¯æŒ &lt;code>peek&amp;lt;T&amp;gt;()&lt;/code>ã€&lt;code>read&amp;lt;T&amp;gt;()&lt;/code>ã€&lt;code>undo()&lt;/code>ã€‚æ¨¡æ¿åŒ–è¯»å–å‡å°‘é‡å¤ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Record&lt;/code>&lt;/td>
&lt;td>Memento&lt;/td>
&lt;td>å¤‡å¿˜å½•ï¼šä¿å­˜â€œè¯»å–å‰çš„å…‰æ ‡ä½ç½® + è¯»å–åˆ°çš„æ•°æ® + ç±»å‹åç§°â€ï¼Œç”± &lt;code>AppState&lt;/code> åœ¨æ¯æ¬¡è¯»å–æ—¶åˆ›å»ºå¹¶å‹å…¥ &lt;code>read_history&lt;/code> æ ˆä¸­ï¼›&lt;code>undo()&lt;/code> æ—¶å¼¹å‡ºå¹¶æ¢å¤ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>TypeTraits&amp;lt;T&amp;gt;&lt;/code>&lt;/td>
&lt;td>Traits&lt;/td>
&lt;td>ç±»å‹ç‰¹å¾ï¼šåœ¨ç¼–è¯‘æœŸå°†åŸºç¡€ç±»å‹ &lt;code>T&lt;/code> ä¸å…¶â€œæ ‡å‡†åç§°ï¼ˆnameï¼‰â€å’Œâ€œç®€çŸ­åç§°ï¼ˆshort_nameï¼‰â€å…³è”ï¼Œä¸º &lt;code>TypeFactory&lt;/code> æä¾›æ˜ å°„æ”¯æŒã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>å…¶ä»–è¾…åŠ©&lt;/strong>&lt;/td>
&lt;td>&lt;strong>RAII / STL å®¹å™¨ / æ™ºèƒ½æŒ‡é’ˆ&lt;/strong>&lt;/td>
&lt;td>ä»£ç ä¸­å¤§é‡ä½¿ç”¨ &lt;code>std::unique_ptr&amp;lt;ReaderStrategy&amp;gt;&lt;/code>ã€&lt;code>std::vector&amp;lt;uint8_t&amp;gt;&lt;/code>ã€&lt;code>std::stack&amp;lt;Record&amp;gt;&lt;/code> ç­‰ï¼Œå‡éµå¾ª RAII æ€æƒ³ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 id="mermaid-ç±»å›¾">Mermaid ç±»å›¾
&lt;/h2>&lt;p>ä¸‹é¢æ˜¯ä¸€å¼ ä»¥ Mermaid è¯­æ³•ç¼–å†™çš„ç±»å›¾ï¼Œå°†å„ä¸»è¦ç±»åŠå…¶å…³ç³»ç›´è§‚å±•ç°ã€‚åªéœ€å°†ä»¥ä¸‹ä»£ç å—å¤åˆ¶åˆ° GitHub ä»“åº“çš„ Markdown æ–‡ä»¶ä¸­å³å¯è‡ªåŠ¨æ¸²æŸ“ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;span class="lnt">96
&lt;/span>&lt;span class="lnt">97
&lt;/span>&lt;span class="lnt">98
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="n">classDiagram&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">å•ä¾‹å·¥å‚ï¼š&lt;/span>&lt;span class="n">TypeFactory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">TypeFactory&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">unordered_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">type_index&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">type_map_&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">TypeFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">type_index&lt;/span> &lt;span class="n">getTypeIndex&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">getTypeShortName&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">å•ä¾‹å·¥å‚ï¼š&lt;/span>&lt;span class="n">ReaderFactory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">ReaderFactory&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">Singleton&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">unordered_map&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">ReaderStrategy&lt;/span>&lt;span class="o">*&amp;gt;&lt;/span> &lt;span class="n">readers_&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">instance&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="ne">bool&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">void&lt;/span> &lt;span class="n">emplaceReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">shortName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">ç­–ç•¥æ¥å£ï¼š&lt;/span>&lt;span class="n">ReaderStrategy&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">ReaderStrategy&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">Interface&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">abstract&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">virtual&lt;/span> &lt;span class="ne">bool&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">å…·ä½“ç­–ç•¥ï¼š&lt;/span>&lt;span class="n">TypedReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">TypedReader&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="ne">bool&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">å…·ä½“ç­–ç•¥ï¼š&lt;/span>&lt;span class="n">FixStringReader&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">FixStringReader&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">length_&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">FixStringReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">len&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="ne">bool&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">å…·ä½“ç­–ç•¥ï¼š&lt;/span>&lt;span class="n">LengthPrefixedStringReader&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">LengthType&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">LengthPrefixedStringReader&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">LengthType&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="ne">bool&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AppState&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="n">AppState&lt;/span> &lt;span class="err">ä¸&lt;/span> &lt;span class="err">å¤‡å¿˜å½•ï¼š&lt;/span>&lt;span class="n">Record&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">AppState&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">cursor_pos_&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">stack&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">Record&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="n">read_history&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">peek&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">template&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">typename&lt;/span> &lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">void&lt;/span> &lt;span class="n">undo&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">getCursorPos&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">void&lt;/span> &lt;span class="n">setCursorPos&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">pos&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">getStatusMsg&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">Record&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">size_t&lt;/span> &lt;span class="n">index&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">any&lt;/span> &lt;span class="n">data&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">-&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">type_name&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">Record&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">size_t&lt;/span> &lt;span class="n">idx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">any&lt;/span> &lt;span class="n">d&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">const&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span>&lt;span class="o">&amp;amp;&lt;/span> &lt;span class="n">t&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">description&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">const&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">ç±»å‹ç‰¹å¾ï¼š&lt;/span>&lt;span class="n">TypeTraits&lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">class&lt;/span> &lt;span class="n">TypeTraits&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span>&lt;span class="n">interface&lt;/span>&lt;span class="o">&amp;gt;&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">name&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">+&lt;/span> &lt;span class="k">static&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="p">::&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="n">short_name&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="err">ç±»ä¹‹é—´å…³ç³»&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">%%&lt;/span> &lt;span class="o">================================&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TypeFactory&lt;/span> &lt;span class="o">--&amp;gt;&lt;/span> &lt;span class="s2">&amp;#34;uses&amp;#34;&lt;/span> &lt;span class="n">TypeTraits&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ReaderFactory&lt;/span> &lt;span class="o">--&amp;gt;&lt;/span> &lt;span class="n">ReaderStrategy&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">maintains&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ReaderFactory&lt;/span> &lt;span class="o">--&amp;gt;&lt;/span> &lt;span class="n">TypeFactory&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">uses&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">TypedReader&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="o">..|&amp;gt;&lt;/span> &lt;span class="n">ReaderStrategy&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">implements&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">FixStringReader&lt;/span> &lt;span class="o">..|&amp;gt;&lt;/span> &lt;span class="n">ReaderStrategy&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">implements&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LengthPrefixedStringReader&lt;/span>&lt;span class="o">~&lt;/span>&lt;span class="n">LengthType&lt;/span>&lt;span class="o">~&lt;/span> &lt;span class="o">..|&amp;gt;&lt;/span> &lt;span class="n">ReaderStrategy&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">implements&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AppState&lt;/span> &lt;span class="o">--&amp;gt;&lt;/span> &lt;span class="n">Record&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">writes&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">AppState&lt;/span> &lt;span class="o">--&amp;gt;&lt;/span> &lt;span class="n">ReaderFactory&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">calls&lt;/span> &lt;span class="o">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Record&lt;/span> &lt;span class="o">..|&amp;gt;&lt;/span> &lt;span class="n">Memento&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">pattern&lt;/span> &lt;span class="n">role&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;strong>è¯´æ˜ï¼š&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>&amp;lt;&amp;lt;Singleton&amp;gt;&amp;gt;&lt;/code> è¡¨ç¤ºå•ä¾‹ç±»ï¼›&lt;/li>
&lt;li>&lt;code>&amp;lt;&amp;lt;Interface&amp;gt;&amp;gt;&lt;/code> è¡¨ç¤ºç­–ç•¥æ¥å£ï¼›&lt;/li>
&lt;li>æ¨¡æ¿ç±»ç”¨ &lt;code>~T~&lt;/code> æˆ– &lt;code>~LengthType~&lt;/code> è¡¨ç¤ºæ³›å‹å‚æ•°ï¼›&lt;/li>
&lt;li>ç®­å¤´ &lt;code>--&amp;gt;&lt;/code> è¡¨ç¤ºä¾èµ–æˆ–ä½¿ç”¨å…³ç³»ï¼›&lt;/li>
&lt;li>å®çº¿åŠç©ºå¿ƒç®­å¤´ &lt;code>..|&amp;gt;&lt;/code> è¡¨ç¤ºç»§æ‰¿æˆ–å®ç°å…³ç³»ï¼›&lt;/li>
&lt;li>&lt;code>Memento&lt;/code> ä»…ä½œæ¨¡å¼è§’è‰²æ ‡æ³¨ï¼Œæ— å¯¹åº”å®é™… C++ ç±»ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="æ•´ä½“æ¶æ„ä¸æ€»ç»“">æ•´ä½“æ¶æ„ä¸æ€»ç»“
&lt;/h2>&lt;ol>
&lt;li>
&lt;p>&lt;strong>è§£è€¦ä¸å¯æ‰©å±•&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>é€šè¿‡ &lt;strong>å•ä¾‹ + å·¥å‚æ¨¡å¼&lt;/strong>ï¼Œå°†â€œç±»å‹æ³¨å†Œâ€ã€â€œè¯»å–å™¨æ³¨å†Œâ€ã€â€œå…·ä½“è¯»å–é€»è¾‘â€é›†ä¸­ç®¡ç†ï¼š&lt;/p>
&lt;ul>
&lt;li>è¦æ–°å¢åŸºç¡€ç±»å‹ï¼Œåªéœ€åœ¨ &lt;code>TypeFactory&lt;/code> ä¸­æ³¨å†Œï¼›&lt;/li>
&lt;li>è¦æ–°å¢è¯»å–æ–¹å¼ï¼Œåªéœ€ç»§æ‰¿ &lt;code>ReaderStrategy&lt;/code> å¹¶åœ¨ &lt;code>ReaderFactory&lt;/code> æ³¨å†Œã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯ UI æˆ–å‘½ä»¤è¡Œè§£æï¼‰åªéœ€è°ƒç”¨ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="kt">bool&lt;/span> &lt;span class="n">ok&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">typeName&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å³å¯å®Œæˆä»å­—èŠ‚æµä¸­è§£æâ€œç±»å‹ä¸º typeName çš„æ•°æ®â€ã€‚æ•´ä¸ªæµç¨‹å¯¹å®¢æˆ·ç«¯é€æ˜ï¼Œæ— éœ€äº†è§£å†…éƒ¨å®ç°ç»†èŠ‚ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>å¯æ’¤é”€çš„è¯»å–ï¼ˆUndoï¼‰&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>é€šè¿‡ &lt;strong>å¤‡å¿˜å½•æ¨¡å¼&lt;/strong>ï¼Œæ¯æ¬¡è¯»å–å‰å°†å½“å‰å…‰æ ‡ä½ç½®å’Œå°†è¦è¯»å–çš„æ•°æ®å€¼æ‰“åŒ…æˆ &lt;code>Record&lt;/code> å¹¶å‹å…¥æ ˆä¸­ã€‚&lt;/li>
&lt;li>ç”¨æˆ·è‹¥éœ€æ’¤é”€ï¼Œåªéœ€è°ƒç”¨ &lt;code>AppState::undo()&lt;/code>ï¼Œå³å¯å°†å…‰æ ‡å›é€€åˆ°ä¸Šä¸€æ¬¡è¯»å–å‰çš„ä½ç½®ï¼Œå¹¶åœ¨çŠ¶æ€æ¶ˆæ¯é‡Œæç¤º â€œUndo to â€¦â€ã€‚&lt;/li>
&lt;li>å¯ä»¥è½»æ¾æ‰©å±•ä¸ºå¤šçº§æ’¤é”€ã€Redoï¼ˆåªéœ€å¦ç»´æŠ¤ä¸€ä¸ªâ€œé‡åšæ ˆâ€ï¼‰ç­‰ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ¨¡æ¿ä¸ç±»å‹ç‰¹å¾&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;code>TypeTraits&amp;lt;T&amp;gt;&lt;/code> åœ¨ç¼–è¯‘æœŸå°† &lt;code>T&lt;/code> ä¸å…¶åç§°ç»‘å®šï¼Œé…åˆ &lt;code>TypeFactory&lt;/code> å®ç°â€œç±»å‹åç§° â†” typeidâ€ çš„åŒå‘æ˜ å°„ã€‚&lt;/li>
&lt;li>&lt;code>AppState::peek&amp;lt;T&amp;gt;()&lt;/code> / &lt;code>read&amp;lt;T&amp;gt;()&lt;/code> ä¸ &lt;code>TypedReader&amp;lt;T&amp;gt;&lt;/code>ï¼Œåˆ©ç”¨æ¨¡æ¿è‡ªåŠ¨ç”Ÿæˆä¸åŒæ•°æ®å®½åº¦çš„è¯»å–ä»£ç ï¼Œé¿å…äº†æ‰‹å†™å¤§é‡ç±»ä¼¼çš„å‡½æ•°ã€‚&lt;/li>
&lt;li>å¦‚æœéœ€è¦åœ¨ä¸åŒå­—èŠ‚åºï¼ˆå°ç«¯/å¤§ç«¯ï¼‰ä¹‹é—´åˆ‡æ¢ï¼Œåªéœ€åœ¨ &lt;code>peek&amp;lt;T&amp;gt;()&lt;/code> å†…æ·»åŠ æ¡ä»¶åˆ†æ”¯æˆ–å†æä¾›å¦ä¸€ä¸ª &lt;code>EndianTraits&lt;/code> å³å¯ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ•´ä½“è°ƒç”¨æµç¨‹ç¤ºä¾‹&lt;/strong>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-cpp" data-lang="cpp">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å‡è®¾ dataVec å­˜æ”¾äº†å¾…è§£æçš„äºŒè¿›åˆ¶æ•°æ®
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">AppState&lt;/span> &lt;span class="nf">state&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dataVec&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç”¨æˆ·æƒ³è¯»å–ä¸€ä¸ª 16 ä½å¸¦ç¬¦å·æ•´æ•° (i16)ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;i16&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getStatusMsg&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="s">&amp;#34;æ— æ³•è§£æç±»å‹ i16&amp;#34;&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// ç»§ç»­è¯»å–ä¸€ä¸ªé•¿åº¦å‰ç¼€å­—ç¬¦ä¸² (string@u16)ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ReaderFactory&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">instance&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;string@u16&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getStatusMsg&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// å¦‚æœå‘ç”Ÿäº†è¯¯æ“ä½œï¼Œç”¨æˆ·æƒ³æ’¤é”€æœ€è¿‘ä¸€æ¬¡è¯»å–ï¼š
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">undo&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">cout&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">state&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getStatusMsg&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">&amp;lt;&amp;lt;&lt;/span> &lt;span class="n">std&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="n">endl&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="c1">// è¾“å‡ºç±»ä¼¼ &amp;#34;Undo to i16 @ 0x02&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¼˜åŠ¿ä¸æ‰©å±•æ€è·¯&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ–°å¢ç±»å‹/è¯»å–æ–¹å¼&lt;/strong>ï¼šåœ¨ &lt;code>TypeFactory&lt;/code> æˆ– &lt;code>ReaderFactory&lt;/code> ä¸­æ·»åŠ æ³¨å†Œé€»è¾‘å³å¯ï¼Œæ— éœ€æ”¹åŠ¨å®¢æˆ·ç«¯è°ƒç”¨ã€‚&lt;/li>
&lt;li>&lt;strong>æ”¯æŒæ›´å¤šå¤æ‚è¯»å–&lt;/strong>ï¼šå¦‚æœæƒ³è¯»å–å‹ç¼©æ•´æ•°ï¼ˆvarintï¼‰ã€ä½åŸŸï¼ˆbitfieldï¼‰æˆ–è‡ªå®šä¹‰åè®®ï¼Œåªéœ€æ–°å»ºå­ç±»ç»§æ‰¿ &lt;code>ReaderStrategy&lt;/code>ï¼Œå¹¶åœ¨å·¥å‚é‡Œæ³¨å†Œã€‚&lt;/li>
&lt;li>&lt;strong>å¯é‡åšï¼ˆRedoï¼‰åŠŸèƒ½&lt;/strong>ï¼šåªè¦åœ¨ &lt;code>undo()&lt;/code> ä¸­å°†å¼¹å‡ºçš„ &lt;code>Record&lt;/code> åŒæ—¶æ¨å…¥ä¸€ä¸ªâ€œé‡åšæ ˆâ€ï¼Œå†å®ç° &lt;code>redo()&lt;/code> å³å¯ã€‚&lt;/li>
&lt;li>&lt;strong>å¯è§†åŒ–/è°ƒè¯•&lt;/strong>ï¼šé€šè¿‡ &lt;code>AppState::getReadHistory()&lt;/code> è·å–å®Œæ•´çš„è¯»å–è®°å½•æ ˆï¼Œå¯è¾“å‡ºåˆ°æ—¥å¿—æˆ–åœ¨ GUI ä¸­å±•ç¤ºã€‚&lt;/li>
&lt;li>&lt;strong>è·¨å¹³å°å­—èŠ‚åº&lt;/strong>ï¼šå¦‚æœéœ€è¦å…¼å®¹å¤§ç«¯æœºå™¨ï¼Œå¯åœ¨ &lt;code>peek&amp;lt;T&amp;gt;()&lt;/code> ä¸­æ ¹æ®è¿è¡Œæ—¶åˆ¤æ–­æˆ–æ¨¡æ¿å‚æ•°åšç›¸åº”è°ƒæ•´ã€‚&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;hr>
&lt;blockquote>
&lt;p>&lt;strong>æœ¬æ–‡æ‰€æœ‰ä»£ç ç¤ºä¾‹å‡å¯åœ¨ C++11 ä»¥ä¸Šç‰ˆæœ¬ä¸‹ç¼–è¯‘è¿è¡Œã€‚&lt;/strong>
è‹¥ä½¿ç”¨æ›´é«˜ç‰ˆæœ¬ï¼ˆC++17ã€C++20ï¼‰ï¼Œå¯ç»“åˆ &lt;code>std::byte&lt;/code>ã€&lt;code>std::variant&lt;/code>ã€&lt;code>std::optional&lt;/code> ç­‰ç‰¹æ€§ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ç±»å‹å®‰å…¨å’Œå¯è¯»æ€§ã€‚&lt;/p>
&lt;/blockquote>
&lt;hr>
&lt;p>&lt;em>ä½œè€…ï¼šxinchen&lt;/em>
&lt;em>é¦–æ¬¡å‘å¸ƒæ—¥æœŸï¼š2025-05-25&lt;/em>
&lt;em>ç‰ˆæƒæ‰€æœ‰ Â© 2025&lt;/em>
&lt;em>ä½œè€…ä¿¡æ¯ï¼šaf83f787e8911dea9b3bf677746ebac9&lt;/em>&lt;/p></description></item><item><title>åŸºäºpythonçš„structæ¨¡å—å®ç°ç®€å•çš„ByteBuf</title><link>https://xinchentechnote.github.io/note/p/%E5%9F%BA%E4%BA%8Epython%E7%9A%84struct%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84bytebuf/</link><pubDate>Sun, 11 May 2025 18:29:30 +0800</pubDate><guid>https://xinchentechnote.github.io/note/p/%E5%9F%BA%E4%BA%8Epython%E7%9A%84struct%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0%E7%AE%80%E5%8D%95%E7%9A%84bytebuf/</guid><description>&lt;h1 id="åŸºäºpythonçš„structæ¨¡å—å®ç°ç®€å•çš„bytebuf">åŸºäºpythonçš„structæ¨¡å—å®ç°ç®€å•çš„ByteBuf
&lt;/h1>&lt;h3 id="å†™åœ¨å‰é¢">&lt;strong>å†™åœ¨å‰é¢&lt;/strong>
&lt;/h3>&lt;p>åœ¨ç½‘ç»œç¼–ç¨‹ä¸­éœ€è¦å°†æ¶ˆæ¯åºåˆ—åŒ–ä¸ºäºŒè¿›åˆ¶åºåˆ—æ‰“åŒ…ä¼ è¾“ã€‚pythonæ ‡å‡†åº“ä¸­çš„structæ¨¡å—æä¾›äº†packã€unpackç­‰å‡½æ•°å°†åŸºæœ¬æ•°æ®ç±»å‹è½¬æ¢ä¸ºå¯¹åº”çš„bytesæ•°ç»„ã€‚ä½¿ç”¨packã€unpackéœ€è¦åœ¨ä¼ å‚æ˜¯éœ€è¦å…³æ³¨å­—èŠ‚åºï¼ˆå¤§å°ç«¯ï¼‰ã€æ ¼å¼ç­‰ï¼Œå…¶ä¸­å­—èŠ‚åºæœ‰@ã€=ã€&amp;lt;ã€&amp;gt;ã€ï¼äº”ç§ï¼Œæ ¼å¼çº¦21ç§ï¼Œä½¿ç”¨æˆæœ¬ç›¸å¯¹é«˜ã€‚æ‰€ä»¥å‚è€ƒNettyçš„ByteBufåŠRustçš„bytesåº“ä¸­çš„Bufã€BufMutä¸ºPythonç®€å•å°è£…ä¸€ä¸ªç±»ä¼¼çš„ByteBufã€‚&lt;/p>
&lt;p>nettyä¸­ByteBufçš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> +-------------------+------------------+------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | discardable bytes | readable bytes | writable bytes |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | (CONTENT) | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> +-------------------+------------------+------------------+
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> | | | |
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0 &amp;lt;= readerIndex &amp;lt;= writerIndex &amp;lt;= capacity
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸€bufæ¥å£è®¾è®¡">&lt;strong>ä¸€ã€Bufæ¥å£è®¾è®¡&lt;/strong>
&lt;/h3>&lt;p>&lt;img src="https://xinchentechnote.github.io/note/note/images/pasted-image-20220405221600.png"
loading="lazy"
alt="Bufæ¥å£"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import abc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import struct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from numpy import longlong
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://netty.io/4.0/api/io/netty/buffer/ByteBuf.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://docs.rs/bytes/1.1.0/bytes/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class Buf(metaclass=abc.ABCMeta):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> class ByteOrder:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NATIVE = &amp;#39;@&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> STD_NATIVE = &amp;#39;=&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LITTLE_ENDIAN = &amp;#39;&amp;lt;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BIG_ENDIAN = &amp;#39;&amp;gt;&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> NETWORK = &amp;#39;!&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> PAD_BYTE = &amp;#39;x&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CHAR = &amp;#39;c&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SIGNED_CHAR = &amp;#39;b&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UNSIGNED_CHAR = &amp;#39;B&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> BOOLEAN = &amp;#39;?&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SHORT = &amp;#39;h&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UNSIGNED_SHORT = &amp;#39;H&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> INT = &amp;#39;i&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UNSIGNED_INT = &amp;#39;I&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LONG = &amp;#39;l&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UNSIGNED_LONG = &amp;#39;L&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> LONG_LONG = &amp;#39;q&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> UNSIGNED_LONG_LONG = &amp;#39;Q&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SSIZE_T = &amp;#39;n&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> SIZE_T = &amp;#39;N&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> EXPONENT = &amp;#39;e&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> FLOAT = &amp;#39;f&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> DOUBLE = &amp;#39;d&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CHAR_ARR = &amp;#39;s&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> CHAR_ARR1 = &amp;#39;p&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> VOID = &amp;#39;P&amp;#39;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def readable_bytes_len(self) -&amp;gt; int:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def to_bytes(self) -&amp;gt; bytearray:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i8(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u8(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_bool(self, value: bool):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i16(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i16_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u16(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u16_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i32(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i32_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u32(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u32_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i64(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i64_le(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u64(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u64_le(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f32(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f32_le(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f64(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f64_le(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_bytes(self, value: bytes):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i8(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u8(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_bool(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i16(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i16_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u16(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u16_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> @abc.abstractmethod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_bytes(self, length: int) -&amp;gt; bytes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> pass
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="äºŒbytebufå…·ä½“å®ç°">&lt;strong>äºŒã€ByteBufå…·ä½“å®ç°&lt;/strong>
&lt;/h3>&lt;p>ByteBufåº•å±‚ä½¿ç”¨å¯ä»¥å­—èŠ‚æ•°ç»„bytearrayä½œå­˜å‚¨ï¼Œè®°å½•åˆ†åˆ«è¯»å†™çš„ä½ç½®ã€‚
&lt;img src="https://xinchentechnote.github.io/note/note/images/pasted-image-20220405221730.png"
loading="lazy"
alt="ByteBuf"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import abc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import struct
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from numpy import longlong
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class ByteBuf(Buf):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def __init__(self, buf: bytearray = None) -&amp;gt; None:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if buf is None:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf = bytearray()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index = 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> else:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf = buf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index = len(buf)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index = 0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def check_readable_bytes_len(self, length: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if self.readable_bytes_len() &amp;lt; length:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> raise Exception(&amp;#34;readable bytes length must greater than or equal %d&amp;#34; % length)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def readable_bytes_len(self) -&amp;gt; int:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return self.write_index - self.read_index
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def to_bytes(self) -&amp;gt; bytearray:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return self.buf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i8(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.SIGNED_CHAR, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u8(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.UNSIGNED_CHAR, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_bool(self, value: bool):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.BOOLEAN, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i16(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.SHORT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i16_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.SHORT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u16(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.UNSIGNED_SHORT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u16_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.UNSIGNED_SHORT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i32(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.INT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i32_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.INT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u32(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.UNSIGNED_INT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u32_le(self, value: int):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.UNSIGNED_INT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i64(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.LONG_LONG, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_i64_le(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.LONG_LONG, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u64(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.UNSIGNED_LONG_LONG, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_u64_le(self, value: longlong):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.UNSIGNED_LONG_LONG, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f32(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.FLOAT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f32_le(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.FLOAT, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f64(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.BIG_ENDIAN + Buf.DOUBLE, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_f64_le(self, value: float):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += struct.pack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.DOUBLE, value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def write_bytes(self, value: bytes):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if len(value) &amp;gt; 0:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf += value
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.write_index += len(value)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i8(self) -&amp;gt; int:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.SIGNED_CHAR, self.buf[self.read_index:self.read_index + 1])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u8(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.UNSIGNED_CHAR, self.buf[self.read_index:self.read_index + 1])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_bool(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.BOOLEAN, self.buf[self.read_index:self.read_index + 1])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i16(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.SHORT, self.buf[self.read_index:self.read_index + 2])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i16_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.SHORT, self.buf[self.read_index:self.read_index + 2])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u16(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.UNSIGNED_SHORT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 2])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u16_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.UNSIGNED_SHORT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 2])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 4])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 4])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.UNSIGNED_INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 4])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.UNSIGNED_INT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 4])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.LONG_LONG,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 8])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_i64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.LONG_LONG,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 8])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.UNSIGNED_LONG_LONG,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 8])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_u64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.UNSIGNED_LONG_LONG,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 8])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.FLOAT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 4])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(4)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.FLOAT,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 4])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.BIG_ENDIAN + Buf.DOUBLE,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 8])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_f64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(8)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = struct.unpack(Buf.ByteOrder.LITTLE_ENDIAN + Buf.DOUBLE,
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf[self.read_index:self.read_index + 8])
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += 8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret[0]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def read_bytes(self, length: int) -&amp;gt; bytearray:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.check_readable_bytes_len(length)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ret = self.buf[self.read_index:self.read_index + length]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.read_index += length
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> return ret
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ä¸‰ç¼–å†™å•å…ƒæµ‹è¯•">&lt;strong>ä¸‰ã€ç¼–å†™å•å…ƒæµ‹è¯•&lt;/strong>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;span class="lnt">182
&lt;/span>&lt;span class="lnt">183
&lt;/span>&lt;span class="lnt">184
&lt;/span>&lt;span class="lnt">185
&lt;/span>&lt;span class="lnt">186
&lt;/span>&lt;span class="lnt">187
&lt;/span>&lt;span class="lnt">188
&lt;/span>&lt;span class="lnt">189
&lt;/span>&lt;span class="lnt">190
&lt;/span>&lt;span class="lnt">191
&lt;/span>&lt;span class="lnt">192
&lt;/span>&lt;span class="lnt">193
&lt;/span>&lt;span class="lnt">194
&lt;/span>&lt;span class="lnt">195
&lt;/span>&lt;span class="lnt">196
&lt;/span>&lt;span class="lnt">197
&lt;/span>&lt;span class="lnt">198
&lt;/span>&lt;span class="lnt">199
&lt;/span>&lt;span class="lnt">200
&lt;/span>&lt;span class="lnt">201
&lt;/span>&lt;span class="lnt">202
&lt;/span>&lt;span class="lnt">203
&lt;/span>&lt;span class="lnt">204
&lt;/span>&lt;span class="lnt">205
&lt;/span>&lt;span class="lnt">206
&lt;/span>&lt;span class="lnt">207
&lt;/span>&lt;span class="lnt">208
&lt;/span>&lt;span class="lnt">209
&lt;/span>&lt;span class="lnt">210
&lt;/span>&lt;span class="lnt">211
&lt;/span>&lt;span class="lnt">212
&lt;/span>&lt;span class="lnt">213
&lt;/span>&lt;span class="lnt">214
&lt;/span>&lt;span class="lnt">215
&lt;/span>&lt;span class="lnt">216
&lt;/span>&lt;span class="lnt">217
&lt;/span>&lt;span class="lnt">218
&lt;/span>&lt;span class="lnt">219
&lt;/span>&lt;span class="lnt">220
&lt;/span>&lt;span class="lnt">221
&lt;/span>&lt;span class="lnt">222
&lt;/span>&lt;span class="lnt">223
&lt;/span>&lt;span class="lnt">224
&lt;/span>&lt;span class="lnt">225
&lt;/span>&lt;span class="lnt">226
&lt;/span>&lt;span class="lnt">227
&lt;/span>&lt;span class="lnt">228
&lt;/span>&lt;span class="lnt">229
&lt;/span>&lt;span class="lnt">230
&lt;/span>&lt;span class="lnt">231
&lt;/span>&lt;span class="lnt">232
&lt;/span>&lt;span class="lnt">233
&lt;/span>&lt;span class="lnt">234
&lt;/span>&lt;span class="lnt">235
&lt;/span>&lt;span class="lnt">236
&lt;/span>&lt;span class="lnt">237
&lt;/span>&lt;span class="lnt">238
&lt;/span>&lt;span class="lnt">239
&lt;/span>&lt;span class="lnt">240
&lt;/span>&lt;span class="lnt">241
&lt;/span>&lt;span class="lnt">242
&lt;/span>&lt;span class="lnt">243
&lt;/span>&lt;span class="lnt">244
&lt;/span>&lt;span class="lnt">245
&lt;/span>&lt;span class="lnt">246
&lt;/span>&lt;span class="lnt">247
&lt;/span>&lt;span class="lnt">248
&lt;/span>&lt;span class="lnt">249
&lt;/span>&lt;span class="lnt">250
&lt;/span>&lt;span class="lnt">251
&lt;/span>&lt;span class="lnt">252
&lt;/span>&lt;span class="lnt">253
&lt;/span>&lt;span class="lnt">254
&lt;/span>&lt;span class="lnt">255
&lt;/span>&lt;span class="lnt">256
&lt;/span>&lt;span class="lnt">257
&lt;/span>&lt;span class="lnt">258
&lt;/span>&lt;span class="lnt">259
&lt;/span>&lt;span class="lnt">260
&lt;/span>&lt;span class="lnt">261
&lt;/span>&lt;span class="lnt">262
&lt;/span>&lt;span class="lnt">263
&lt;/span>&lt;span class="lnt">264
&lt;/span>&lt;span class="lnt">265
&lt;/span>&lt;span class="lnt">266
&lt;/span>&lt;span class="lnt">267
&lt;/span>&lt;span class="lnt">268
&lt;/span>&lt;span class="lnt">269
&lt;/span>&lt;span class="lnt">270
&lt;/span>&lt;span class="lnt">271
&lt;/span>&lt;span class="lnt">272
&lt;/span>&lt;span class="lnt">273
&lt;/span>&lt;span class="lnt">274
&lt;/span>&lt;span class="lnt">275
&lt;/span>&lt;span class="lnt">276
&lt;/span>&lt;span class="lnt">277
&lt;/span>&lt;span class="lnt">278
&lt;/span>&lt;span class="lnt">279
&lt;/span>&lt;span class="lnt">280
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">import os, sys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sys.path.append(os.getcwd())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from unittest import TestCase
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">import pytest
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">from buf.byte_buf import ByteBuf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">class TestByteBuf(TestCase):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def setUp(self) -&amp;gt; None:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf = ByteBuf()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_byte_buf(self) -&amp;gt; int:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> buf1 = ByteBuf(self.buf.to_bytes())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(7, buf1.readable_bytes_len())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_readable_bytes_len(self) -&amp;gt; int:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(7, self.buf.readable_bytes_len())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_to_bytes(self) -&amp;gt; bytes:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(b&amp;#39;\x7f\x7f\x01&amp;#39;, self.buf.to_bytes())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i8(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(-128)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-128, self.buf.read_i8())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i8())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i8())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i8_failed1(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(128)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i8_failed2(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i8(-129)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i8_failed3(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.read_i8()
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u8(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u8(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u8(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u8(255)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_u8())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_u8())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(255, self.buf.read_u8())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u8_failed1(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u8(-1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u8_failed2(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u8(256)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_bool(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_bool(True)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_bool(False)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_bool(1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_bool(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_bool(22222)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertTrue(self.buf.read_bool())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertFalse(self.buf.read_bool())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertTrue(self.buf.read_bool())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertFalse(self.buf.read_bool())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertTrue(self.buf.read_bool())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i16(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16(-32768)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16(32767)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-32768, self.buf.read_i16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(32767, self.buf.read_i16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i16_failed1(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16(-32769)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i16_failed2(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16(32768)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i16_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16_le(-32768)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16_le(32767)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i16_le(32767)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-32768, self.buf.read_i16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(32767, self.buf.read_i16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(32767, self.buf.read_i16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u16(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16(65535)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_u16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_u16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(65535, self.buf.read_u16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u16_failed1(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16(-1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u16_failed2(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16(65536)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u16_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16_le(65535)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u16_le(65534)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_u16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_u16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(65535, self.buf.read_u16_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(65534, self.buf.read_u16())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32(-2 ** 31)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32(2 ** 31 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-2 ** 31, self.buf.read_i32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_i32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 31 - 1, self.buf.read_i32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32_le(-2 ** 31)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i32_le(2 ** 31 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-2 ** 31, self.buf.read_i32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_i32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 31 - 1, self.buf.read_i32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32(2 ** 32 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_u32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_u32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_u32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 32 - 1, self.buf.read_u32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u32_failed1(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32(-1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u32_failed2(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> with pytest.raises(Exception):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32(2 ** 32)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u32_le(2 ** 32 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_u32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_u32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_u32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 32 - 1, self.buf.read_u32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64(- 2 ** 63)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64(2 ** 63 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-2 ** 63, self.buf.read_i64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 63 - 1, self.buf.read_i64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_i64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(- 2 ** 63)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(2 ** 63 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-2 ** 63, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_i64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 63 - 1, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(- 2 ** 63)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_i64_le(2 ** 63 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(-2 ** 63, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_i64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 63 - 1, self.buf.read_i64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_u64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u64_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_u64_le(2 ** 64 - 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_u64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_u64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_u64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(2 ** 64 - 1, self.buf.read_u64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_f32(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32(12.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_f32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_f32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_f32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(12.0, self.buf.read_f32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_f32_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f32_le(12.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_f32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_f32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_f32())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(12.0, self.buf.read_f32_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_f64(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64(12.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_f64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_f64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_f64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(12.0, self.buf.read_f64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_f64_le(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64_le(0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64_le(127)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_f64_le(12.0)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(0, self.buf.read_f64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(127, self.buf.read_f64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertNotEqual(127, self.buf.read_f64())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(12.0, self.buf.read_f64_le())
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> def test_write_bytes(self):
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.buf.write_bytes(b&amp;#39;hello&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(b&amp;#39;hel&amp;#39;, self.buf.read_bytes(3))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> self.assertEqual(b&amp;#39;lo&amp;#39;, self.buf.read_bytes(2))
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ‰§è¡Œå•å…ƒæµ‹è¯•&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">buf\test_byte_buf.py .................................. [100%]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">============================================================================================= 34 passed in 0.60s ==============================================================================================
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="å››æ€»ç»“">&lt;strong>å››ã€æ€»ç»“&lt;/strong>ï¼š
&lt;/h3>&lt;p>è¯¥ByteBufä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä»…æä¾›äº†é¡ºåºè¯»å†™çš„èƒ½åŠ›ï¼Œæœªæ¥åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­æ ¹æ®å®é™…å®Œå–„ï¼Œæ¯”å¦‚éšæœºè¯»å†™èƒ½åŠ›ï¼ŒåŸºäºå¤šä¸ªByteBufè¿›è¡ŒWrapperç»„åˆæ„å»ºæ–°çš„ByteBufç­‰ã€‚&lt;/p>
&lt;p>å‚è€ƒæ–‡æ¡£ï¼š&lt;br>
&lt;a class="link" href="https://netty.io/4.0/api/io/netty/buffer/ByteBuf.html" target="_blank" rel="noopener"
>https://netty.io/4.0/api/io/netty/buffer/ByteBuf.html&lt;/a>
&lt;a class="link" href="https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html" target="_blank" rel="noopener"
>https://docs.oracle.com/javase/8/docs/api/java/nio/ByteBuffer.html&lt;/a>
&lt;a class="link" href="https://docs.rs/bytes/1.1.0/bytes/" target="_blank" rel="noopener"
>https://docs.rs/bytes/1.1.0/bytes/&lt;/a>&lt;/p>
&lt;p>&lt;em>ä½œè€…ï¼šxinchen&lt;/em>
&lt;em>é¦–æ¬¡å‘å¸ƒæ—¥æœŸï¼š2025-05-25&lt;/em>
&lt;em>ç‰ˆæƒæ‰€æœ‰ Â© 2025&lt;/em>
&lt;em>ä½œè€…ä¿¡æ¯ï¼šaf83f787e8911dea9b3bf677746ebac9&lt;/em>&lt;/p>
&lt;h3 id="ä¸‹æœŸé¢„å‘ŠåŸºäºbytebufå®ç°å¯¹äº¤æ˜“æ‰€äº¤æ˜“æ¥å£æ¶ˆæ¯çš„å°è£…">&lt;em>ä¸‹æœŸé¢„å‘Š&lt;/em>ï¼šåŸºäºBytebufå®ç°å¯¹äº¤æ˜“æ‰€äº¤æ˜“æ¥å£æ¶ˆæ¯çš„å°è£…
&lt;/h3></description></item><item><title>Java å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½å®æµ‹ï¼šåŸºäº JMH çš„å¾®åŸºå‡†æµ‹è¯•</title><link>https://xinchentechnote.github.io/note/p/java-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%A7%E8%83%BD%E5%AE%9E%E6%B5%8B%E5%9F%BA%E4%BA%8E-jmh-%E7%9A%84%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/</link><pubDate>Sun, 11 May 2025 10:29:30 +0800</pubDate><guid>https://xinchentechnote.github.io/note/p/java-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E6%80%A7%E8%83%BD%E5%AE%9E%E6%B5%8B%E5%9F%BA%E4%BA%8E-jmh-%E7%9A%84%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/</guid><description>&lt;h1 id="java-å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½å®æµ‹åŸºäº-jmh-çš„å¾®åŸºå‡†æµ‹è¯•">Java å­—ç¬¦ä¸²æ‹¼æ¥æ€§èƒ½å®æµ‹ï¼šåŸºäº JMH çš„å¾®åŸºå‡†æµ‹è¯•
&lt;/h1>&lt;p>åœ¨ Java å¼€å‘ä¸­ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ“ä½œæ— å¤„ä¸åœ¨ã€‚ä½ å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨ &lt;code>+&lt;/code>ï¼Œä¹Ÿå¯èƒ½é€‰æ‹© &lt;code>StringBuilder&lt;/code> æˆ– &lt;code>StringBuffer&lt;/code>ã€‚å®ƒä»¬åœ¨æ€§èƒ½ä¸Šç©¶ç«Ÿæœ‰ä½•å·®åˆ«ï¼Ÿåœ¨å¾ªç¯ä¸­æ‹¼æ¥å¤šä¸ªå­—ç¬¦ä¸²æ—¶ï¼Œå“ªç§æ–¹å¼æ›´é«˜æ•ˆï¼Ÿ&lt;/p>
&lt;p>æœ¬æ–‡åŸºäº JMHï¼ˆJava Microbenchmark Harnessï¼‰è¿›è¡Œäº†ç³»ç»Ÿæ€§æµ‹è¯•ï¼Œå¹¶ä½¿ç”¨ GitHub Actions åœ¨ Ubuntu ç¯å¢ƒä¸­å®æµ‹äº†ä¸åŒå­—ç¬¦ä¸²æ‹¼æ¥æ–¹å¼çš„æ€§èƒ½ã€‚&lt;/p>
&lt;hr>
&lt;h2 id="-æµ‹è¯•ç›®æ ‡">ğŸ§ª æµ‹è¯•ç›®æ ‡
&lt;/h2>&lt;p>æ¯”è¾ƒä»¥ä¸‹ä¸‰ç§æ‹¼æ¥æ–¹å¼åœ¨é«˜é¢‘åœºæ™¯ä¸‹çš„æ€§èƒ½å·®å¼‚ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;code>+&lt;/code> æ“ä½œç¬¦ï¼ˆè¯­æ³•ç³–ï¼Œç¼–è¯‘æœŸè½¬ä¸º &lt;code>StringBuilder.append&lt;/code>ï¼‰&lt;/li>
&lt;li>&lt;code>StringBuilder.append&lt;/code>&lt;/li>
&lt;li>&lt;code>StringBuffer.append&lt;/code>&lt;/li>
&lt;/ol>
&lt;hr>
&lt;h2 id="-é¡¹ç›®åˆ›å»ºä¸é…ç½®maven">ğŸ§° é¡¹ç›®åˆ›å»ºä¸é…ç½®ï¼ˆMavenï¼‰
&lt;/h2>&lt;h3 id="1-åˆ›å»ºåŸºç¡€å·¥ç¨‹">1. åˆ›å»ºåŸºç¡€å·¥ç¨‹
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mvn archetype:generate &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -DgroupId&lt;span class="o">=&lt;/span>com.xinchentechnote &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -DartifactId&lt;span class="o">=&lt;/span>string-jmh &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -DarchetypeArtifactId&lt;span class="o">=&lt;/span>maven-archetype-quickstart &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -DinteractiveMode&lt;span class="o">=&lt;/span>&lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-é…ç½®-pomxml">2. é…ç½® &lt;code>pom.xml&lt;/code>
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-xml" data-lang="xml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.openjdk.jmh&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>jmh-core&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>1.37&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.openjdk.jmh&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>jmh-generator-annprocess&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>1.37&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;scope&amp;gt;&lt;/span>provided&lt;span class="nt">&amp;lt;/scope&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dependency&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dependencies&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;build&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;plugins&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;plugin&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.apache.maven.plugins&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>maven-compiler-plugin&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>3.8.1&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;source&amp;gt;&lt;/span>17&lt;span class="nt">&amp;lt;/source&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;target&amp;gt;&lt;/span>17&lt;span class="nt">&amp;lt;/target&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;annotationProcessorPaths&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;path&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;groupId&amp;gt;&lt;/span>org.openjdk.jmh&lt;span class="nt">&amp;lt;/groupId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;artifactId&amp;gt;&lt;/span>jmh-generator-annprocess&lt;span class="nt">&amp;lt;/artifactId&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;version&amp;gt;&lt;/span>1.37&lt;span class="nt">&amp;lt;/version&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/path&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/annotationProcessorPaths&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/configuration&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/plugin&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/plugins&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/build&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="-æµ‹è¯•ä»£ç å®ç°">ğŸ“„ æµ‹è¯•ä»£ç å®ç°
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">package&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">com.xinchentechnote&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">org.openjdk.jmh.annotations.*&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kn">import&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nn">java.util.concurrent.TimeUnit&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@BenchmarkMode&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="n">Mode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Throughput&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">AverageTime&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@OutputTimeUnit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MICROSECONDS&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@State&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Scope&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Thread&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kd">class&lt;/span> &lt;span class="nc">StringConcatBenchmark&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Hello&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str2&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;World&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str3&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;Java&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">private&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">100&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Benchmark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">testStringBuilder&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuilder&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Benchmark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">testStringBuffer&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuffer&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">StringBuffer&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str1&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str2&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">str3&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">sb&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">toString&lt;/span>&lt;span class="p">();&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nd">@Benchmark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="kd">public&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nf">testStringPlus&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">for&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">&amp;lt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">count&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="o">++&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str1&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str2&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">+=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">str3&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">return&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">result&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="-github-actions-è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®">ğŸš€ GitHub Actions è‡ªåŠ¨åŒ–æµ‹è¯•é…ç½®
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">JMH Benchmarks&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">workflow_dispatch&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">benchmark&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/setup-java@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">distribution&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">temurin&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">java-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;17&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cache&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">maven&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">mvn clean install -DskipTests&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">java -jar target/benchmarks.jar StringConcatBenchmark&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;hr>
&lt;h2 id="-å®æµ‹ç»“æœubuntu--github-actions">ğŸ“Š å®æµ‹ç»“æœï¼ˆUbuntu + GitHub Actionsï¼‰
&lt;/h2>&lt;h3 id="-ååé‡æµ‹è¯•throughput">ğŸ“ˆ ååé‡æµ‹è¯•ï¼ˆThroughputï¼‰
&lt;/h3>&lt;p>å•ä½ï¼šæ¯å¾®ç§’æ‰§è¡Œçš„æ“ä½œæ•°ï¼ˆops/usï¼‰&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ³•&lt;/th>
&lt;th>ååé‡&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>StringBuilder&lt;/code>&lt;/td>
&lt;td>&lt;strong>0.478 ops/us&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>StringBuffer&lt;/code>&lt;/td>
&lt;td>0.448 ops/us&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>+&lt;/code> æ“ä½œç¬¦&lt;/td>
&lt;td>ğŸš« 0.199 ops/us&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="-å¹³å‡è€—æ—¶æµ‹è¯•averagetime">â± å¹³å‡è€—æ—¶æµ‹è¯•ï¼ˆAverageTimeï¼‰
&lt;/h3>&lt;p>å•ä½ï¼šæ¯æ¬¡æ“ä½œçš„å¹³å‡è€—æ—¶ï¼ˆus/opï¼‰&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ–¹æ³•&lt;/th>
&lt;th>å¹³å‡è€—æ—¶&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>StringBuilder&lt;/code>&lt;/td>
&lt;td>&lt;strong>2.021 us/op&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>StringBuffer&lt;/code>&lt;/td>
&lt;td>2.237 us/op&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>+&lt;/code> æ“ä½œç¬¦&lt;/td>
&lt;td>ğŸš« 5.244 us/op&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 id="-åŸç†è§£æ">ğŸ” åŸç†è§£æ
&lt;/h2>&lt;ul>
&lt;li>&lt;code>StringBuilder&lt;/code>ï¼šéçº¿ç¨‹å®‰å…¨ä½†æ€§èƒ½æœ€å¥½ï¼Œæ¨èåœ¨å¾ªç¯ä¸­ä½¿ç”¨ã€‚&lt;/li>
&lt;li>&lt;code>StringBuffer&lt;/code>ï¼šçº¿ç¨‹å®‰å…¨ä½†æ€§èƒ½ç•¥ä½ã€‚&lt;/li>
&lt;li>&lt;code>+&lt;/code> æ“ä½œç¬¦ï¼šè™½ç„¶ç›´è§‚ï¼Œä½†åœ¨å¾ªç¯ä¸­æå…¶ä½æ•ˆï¼Œä¼šé¢‘ç¹åˆ›å»ºä¸´æ—¶å¯¹è±¡ï¼Œå¸¦æ¥ GC å‹åŠ›ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="-ä½¿ç”¨å»ºè®®">âœ… ä½¿ç”¨å»ºè®®
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ‹¼æ¥æ–¹å¼&lt;/th>
&lt;th>ä¼˜ç‚¹&lt;/th>
&lt;th>ç¼ºç‚¹&lt;/th>
&lt;th>æ¨èåœºæ™¯&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>StringBuilder&lt;/td>
&lt;td>æ€§èƒ½æœ€ä½³&lt;/td>
&lt;td>éçº¿ç¨‹å®‰å…¨&lt;/td>
&lt;td>å•çº¿ç¨‹é«˜é¢‘æ‹¼æ¥&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>StringBuffer&lt;/td>
&lt;td>çº¿ç¨‹å®‰å…¨&lt;/td>
&lt;td>æ€§èƒ½ç•¥å·®&lt;/td>
&lt;td>å¤šçº¿ç¨‹æ‹¼æ¥åœºæ™¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>+&lt;/code> æ“ä½œç¬¦&lt;/td>
&lt;td>ç®€æ´ç›´è§‚&lt;/td>
&lt;td>æ…¢ä¸” GC å‹åŠ›å¤§&lt;/td>
&lt;td>ä½é¢‘ç®€æ˜“æ‹¼æ¥&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;hr>
&lt;h2 id="-æ€»ç»“">ğŸ æ€»ç»“
&lt;/h2>&lt;p>æœ¬æ¬¡ JMH å®æµ‹éªŒè¯äº†å¼€å‘ç»éªŒä¸­çš„æœ€ä½³å®è·µï¼š&lt;strong>åœ¨é«˜é¢‘åœºæ™¯ä¸­ï¼Œæ¨èä½¿ç”¨ &lt;code>StringBuilder&lt;/code> è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ã€‚&lt;/strong>&lt;/p>
&lt;hr>
&lt;h3 id="-jmh-å°çŸ¥è¯†java-å¾®åŸºå‡†æµ‹è¯•åˆ©å™¨">ğŸ’¡ JMH å°çŸ¥è¯†ï¼šJava å¾®åŸºå‡†æµ‹è¯•åˆ©å™¨
&lt;/h3>&lt;p>&lt;a class="link" href="https://openjdk.org/projects/code-tools/jmh/" target="_blank" rel="noopener"
>JMH (Java Microbenchmark Harness)&lt;/a> æ˜¯ç”± Oracle å’Œ OpenJDK å›¢é˜Ÿä¸“ä¸º Java ç¼–å†™çš„å¾®åŸºå‡†æµ‹è¯•æ¡†æ¶ï¼Œç”¨äºè¡¡é‡ Java æ–¹æ³•åœ¨çº³ç§’åˆ°å¾®ç§’çº§åˆ«çš„æ€§èƒ½è¡¨ç°ã€‚JMH ç‰¹åˆ«é€‚ç”¨äºéœ€è¦ç²¾ç»†åˆ†ææ–¹æ³•è°ƒç”¨å¼€é”€ã€ç¼–è¯‘ä¼˜åŒ–ã€å‰¯ä½œç”¨ç­‰å¯¹æ€§èƒ½å½±å“çš„åœºæ™¯ã€‚&lt;/p>
&lt;h4 id="æ ¸å¿ƒæœ¯è¯­ä¸æ³¨è§£è§£é‡Š">æ ¸å¿ƒæœ¯è¯­ä¸æ³¨è§£è§£é‡Šï¼š
&lt;/h4>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ³¨è§£æˆ–å‚æ•°&lt;/th>
&lt;th>å«ä¹‰&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>@Benchmark&lt;/code>&lt;/td>
&lt;td>æ ‡è®°è¦è¢«æµ‹è¯•çš„æ–¹æ³•ã€‚æ¯æ¬¡è¿è¡Œéƒ½è°ƒç”¨å®ƒå¹¶æ”¶é›†æ€§èƒ½æ•°æ®ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>@BenchmarkMode&lt;/code>&lt;/td>
&lt;td>è®¾ç½®åŸºå‡†æµ‹è¯•çš„æ¨¡å¼ï¼ˆå¦‚ååé‡ã€å¹³å‡æ—¶é—´ç­‰ï¼‰ã€‚å¯é€‰å€¼åŒ…æ‹¬ï¼š- &lt;code>Throughput&lt;/code>: å•ä½æ—¶é—´å†…æ“ä½œæ¬¡æ•°- &lt;code>AverageTime&lt;/code>: æ¯ä¸ªæ“ä½œå¹³å‡è€—æ—¶- &lt;code>SampleTime&lt;/code>, &lt;code>SingleShotTime&lt;/code>, &lt;code>AllModes&lt;/code>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>@OutputTimeUnit&lt;/code>&lt;/td>
&lt;td>è®¾ç½®è¾“å‡ºç»“æœçš„æ—¶é—´å•ä½ï¼Œå¦‚ &lt;code>TimeUnit.MILLISECONDS&lt;/code> æˆ– &lt;code>MICROSECONDS&lt;/code>ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>@State&lt;/code>&lt;/td>
&lt;td>ç”¨äºç®¡ç†åŸºå‡†æ–¹æ³•æ‰€éœ€çš„çŠ¶æ€å˜é‡ä½œç”¨åŸŸã€‚å¸¸ç”¨ &lt;code>Scope.Thread&lt;/code> è¡¨ç¤ºæ¯çº¿ç¨‹ç‹¬ç«‹çŠ¶æ€ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>@Fork&lt;/code>&lt;/td>
&lt;td>è®¾ç½®æ‰§è¡Œå‡ è½® JVM å¯åŠ¨æ¥è§„é¿ JVM çƒ­èº«é˜¶æ®µçš„å½±å“ï¼Œé€šå¸¸è®¾ç½®ä¸º 1~3ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>@Warmup&lt;/code>&lt;/td>
&lt;td>é¢„çƒ­æ¬¡æ•°ä¸æ¯æ¬¡æŒç»­æ—¶é—´ï¼ˆJIT ç¼–è¯‘ä¼˜åŒ–å‘ç”Ÿåœ¨æ­¤é˜¶æ®µï¼‰ã€‚é¿å…å†·å¯åŠ¨å½±å“åŸºå‡†æ•°æ®ã€‚&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>@Measurement&lt;/code>&lt;/td>
&lt;td>çœŸæ­£é‡‡é›†æ€§èƒ½æ•°æ®çš„æ¬¡æ•°å’ŒæŒç»­æ—¶é—´ã€‚å»ºè®®è‡³å°‘ &lt;code>5 æ¬¡ Ã— 1s+&lt;/code>ã€‚&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="æ¨èé…ç½®å‚æ•°è¯´æ˜">æ¨èé…ç½®å‚æ•°è¯´æ˜ï¼š
&lt;/h4>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@BenchmarkMode&lt;/span>&lt;span class="p">({&lt;/span>&lt;span class="n">Mode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Throughput&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Mode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">AverageTime&lt;/span>&lt;span class="p">})&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// åŒæ—¶æµ‹ååé‡å’Œå¹³å‡è€—æ—¶&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@OutputTimeUnit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TimeUnit&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">MICROSECONDS&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¾“å‡ºå¾®ç§’ä¸ºå•ä½&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@State&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Scope&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">Thread&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ¯ä¸ªçº¿ç¨‹ç‹¬ç«‹çŠ¶æ€&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Fork&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¯åŠ¨ 1 æ¬¡ JVM&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Warmup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterations&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// é¢„çƒ­ 5 æ¬¡ï¼Œæ¯æ¬¡ 1 ç§’&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nd">@Measurement&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">iterations&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">time&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">1&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// é‡‡æ · 5 æ¬¡ï¼Œæ¯æ¬¡ 1 ç§’&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h4 id="ä¸ºä»€ä¹ˆä¸èƒ½ç®€å•ç”¨-systemcurrenttimemillis">ä¸ºä»€ä¹ˆä¸èƒ½ç®€å•ç”¨ System.currentTimeMillisï¼Ÿ
&lt;/h4>&lt;p>å› ä¸º JVM å¯åŠ¨åˆæœŸ JIT ç¼–è¯‘æœªå®Œæˆã€å†…è”å°šæœªå±•å¼€ã€é€ƒé€¸åˆ†æç­‰ä¼˜åŒ–æœºåˆ¶å°šæœªä»‹å…¥ï¼Œåˆå§‹è¿è¡Œçš„è€—æ—¶éå¸¸ä¸ç¨³å®šã€‚è€Œ JMH é€šè¿‡ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>è‡ªåŠ¨ warm-up é¢„çƒ­é˜¶æ®µï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¤šè½® fork JVM éš”ç¦»ä¼˜åŒ–å½±å“ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç»Ÿè®¡è¯¯å·®å’Œæ³¢åŠ¨èŒƒå›´ï¼ˆErrorï¼‰ï¼›&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ç¡®ä¿äº†æµ‹å¾—ç»“æœæ›´çœŸå®ã€æ›´æ¥è¿‘åº”ç”¨å®é™…è¡¨ç°ã€‚&lt;/p>
&lt;hr>
&lt;p>å¸Œæœ›æœ¬æ–‡èƒ½ä¸ºä½ åœ¨æ—¥å¸¸å¼€å‘ä¸æ€§èƒ½ä¼˜åŒ–ä¸­æä¾›é‡åŒ–å‚è€ƒï¼
&lt;em>ä½œè€…ï¼šxinchen&lt;/em>
&lt;em>é¦–æ¬¡å‘å¸ƒæ—¥æœŸï¼š2025-05-25&lt;/em>
&lt;em>ç‰ˆæƒæ‰€æœ‰ Â© 2025&lt;/em>
&lt;em>ä½œè€…ä¿¡æ¯ï¼šaf83f787e8911dea9b3bf677746ebac9&lt;/em>&lt;/p></description></item><item><title>Archives</title><link>https://xinchentechnote.github.io/note/archives/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://xinchentechnote.github.io/note/archives/</guid><description/></item><item><title>Links</title><link>https://xinchentechnote.github.io/note/links/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://xinchentechnote.github.io/note/links/</guid><description>&lt;p>To use this feature, add &lt;code>links&lt;/code> section to frontmatter.&lt;/p>
&lt;p>This page&amp;rsquo;s frontmatter:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">links&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitHub&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">GitHub is the world&amp;#39;s largest software development platform.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">website&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.com&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">title&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TypeScript&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">description&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TypeScript is a typed superset of JavaScript that compiles to plain JavaScript.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">website&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">https://www.typescriptlang.org&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ts-logo-128.jpg&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>image&lt;/code> field accepts both local and external images.&lt;/p></description></item><item><title>Search</title><link>https://xinchentechnote.github.io/note/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://xinchentechnote.github.io/note/search/</guid><description/></item><item><title>å…³äº</title><link>https://xinchentechnote.github.io/note/%E5%85%B3%E4%BA%8E/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://xinchentechnote.github.io/note/%E5%85%B3%E4%BA%8E/</guid><description>&lt;p>This is a test page for i18n support.&lt;/p></description></item></channel></rss>